(this.webpackJsonprevision=this.webpackJsonprevision||[]).push([[0],{23:function(t,e,n){var r,i,a;i=[n(443)],void 0===(a="function"===typeof(r=function(t){"use strict";var e=t.Reader,n=t.Writer,r=t.util,i=t.roots.default||(t.roots.default={});return i.Timestamp=function(){function a(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return a.prototype.seconds=0,a.prototype.nanos=0,a.create=function(t){return new a(t)},a.encode=function(t,e){return e||(e=n.create()),null!=t.seconds&&Object.hasOwnProperty.call(t,"seconds")&&e.uint32(8).int32(t.seconds),null!=t.nanos&&Object.hasOwnProperty.call(t,"nanos")&&e.uint32(16).int32(t.nanos),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,a=new i.Timestamp;t.pos<r;){var c=t.uint32();switch(c>>>3){case 1:a.seconds=t.int32();break;case 2:a.nanos=t.int32();break;default:t.skipType(7&c)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.seconds&&t.hasOwnProperty("seconds")&&!r.isInteger(t.seconds)?"seconds: integer expected":null!=t.nanos&&t.hasOwnProperty("nanos")&&!r.isInteger(t.nanos)?"nanos: integer expected":null},a.fromObject=function(t){if(t instanceof i.Timestamp)return t;var e=new i.Timestamp;return null!=t.seconds&&(e.seconds=0|t.seconds),null!=t.nanos&&(e.nanos=0|t.nanos),e},a.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.seconds=0,n.nanos=0),null!=t.seconds&&t.hasOwnProperty("seconds")&&(n.seconds=t.seconds),null!=t.nanos&&t.hasOwnProperty("nanos")&&(n.nanos=t.nanos),n},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Duration=function(){function a(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return a.prototype.seconds=0,a.prototype.nanos=0,a.create=function(t){return new a(t)},a.encode=function(t,e){return e||(e=n.create()),null!=t.seconds&&Object.hasOwnProperty.call(t,"seconds")&&e.uint32(8).int32(t.seconds),null!=t.nanos&&Object.hasOwnProperty.call(t,"nanos")&&e.uint32(16).int32(t.nanos),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,a=new i.Duration;t.pos<r;){var c=t.uint32();switch(c>>>3){case 1:a.seconds=t.int32();break;case 2:a.nanos=t.int32();break;default:t.skipType(7&c)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.seconds&&t.hasOwnProperty("seconds")&&!r.isInteger(t.seconds)?"seconds: integer expected":null!=t.nanos&&t.hasOwnProperty("nanos")&&!r.isInteger(t.nanos)?"nanos: integer expected":null},a.fromObject=function(t){if(t instanceof i.Duration)return t;var e=new i.Duration;return null!=t.seconds&&(e.seconds=0|t.seconds),null!=t.nanos&&(e.nanos=0|t.nanos),e},a.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.seconds=0,n.nanos=0),null!=t.seconds&&t.hasOwnProperty("seconds")&&(n.seconds=t.seconds),null!=t.nanos&&t.hasOwnProperty("nanos")&&(n.nanos=t.nanos),n},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Scrap=function(){function a(t){if(this.childScraps=[],this.writingHistory=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return a.prototype.id="",a.prototype.intendedDurationSec=0,a.prototype.synopsis="",a.prototype.prose="",a.prototype.childScraps=r.emptyArray,a.prototype.completeness=0,a.prototype.writingHistory=r.emptyArray,a.create=function(t){return new a(t)},a.encode=function(t,e){if(e||(e=n.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(10).string(t.id),null!=t.intendedDurationSec&&Object.hasOwnProperty.call(t,"intendedDurationSec")&&e.uint32(16).uint32(t.intendedDurationSec),null!=t.synopsis&&Object.hasOwnProperty.call(t,"synopsis")&&e.uint32(26).string(t.synopsis),null!=t.prose&&Object.hasOwnProperty.call(t,"prose")&&e.uint32(34).string(t.prose),null!=t.childScraps&&t.childScraps.length)for(var r=0;r<t.childScraps.length;++r)e.uint32(74).string(t.childScraps[r]);if(null!=t.completeness&&Object.hasOwnProperty.call(t,"completeness")&&e.uint32(80).int32(t.completeness),null!=t.writingHistory&&t.writingHistory.length)for(r=0;r<t.writingHistory.length;++r)i.Scrap.WritingHistory.encode(t.writingHistory[r],e.uint32(90).fork()).ldelim();return e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,a=new i.Scrap;t.pos<r;){var c=t.uint32();switch(c>>>3){case 1:a.id=t.string();break;case 2:a.intendedDurationSec=t.uint32();break;case 3:a.synopsis=t.string();break;case 4:a.prose=t.string();break;case 9:a.childScraps&&a.childScraps.length||(a.childScraps=[]),a.childScraps.push(t.string());break;case 10:a.completeness=t.int32();break;case 11:a.writingHistory&&a.writingHistory.length||(a.writingHistory=[]),a.writingHistory.push(i.Scrap.WritingHistory.decode(t,t.uint32()));break;default:t.skipType(7&c)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!r.isString(t.id))return"id: string expected";if(null!=t.intendedDurationSec&&t.hasOwnProperty("intendedDurationSec")&&!r.isInteger(t.intendedDurationSec))return"intendedDurationSec: integer expected";if(null!=t.synopsis&&t.hasOwnProperty("synopsis")&&!r.isString(t.synopsis))return"synopsis: string expected";if(null!=t.prose&&t.hasOwnProperty("prose")&&!r.isString(t.prose))return"prose: string expected";if(null!=t.childScraps&&t.hasOwnProperty("childScraps")){if(!Array.isArray(t.childScraps))return"childScraps: array expected";for(var e=0;e<t.childScraps.length;++e)if(!r.isString(t.childScraps[e]))return"childScraps: string[] expected"}if(null!=t.completeness&&t.hasOwnProperty("completeness"))switch(t.completeness){default:return"completeness: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=t.writingHistory&&t.hasOwnProperty("writingHistory")){if(!Array.isArray(t.writingHistory))return"writingHistory: array expected";for(e=0;e<t.writingHistory.length;++e){var n=i.Scrap.WritingHistory.verify(t.writingHistory[e]);if(n)return"writingHistory."+n}}return null},a.fromObject=function(t){if(t instanceof i.Scrap)return t;var e=new i.Scrap;if(null!=t.id&&(e.id=String(t.id)),null!=t.intendedDurationSec&&(e.intendedDurationSec=t.intendedDurationSec>>>0),null!=t.synopsis&&(e.synopsis=String(t.synopsis)),null!=t.prose&&(e.prose=String(t.prose)),t.childScraps){if(!Array.isArray(t.childScraps))throw TypeError(".Scrap.childScraps: array expected");e.childScraps=[];for(var n=0;n<t.childScraps.length;++n)e.childScraps[n]=String(t.childScraps[n])}switch(t.completeness){case"NOT_STARTED":case 0:e.completeness=0;break;case"BRAINSTORM":case 1:e.completeness=1;break;case"INITIAL_DRAFT":case 2:e.completeness=2;break;case"POLISHED":case 3:e.completeness=3;break;case"FINAL":case 4:e.completeness=4}if(t.writingHistory){if(!Array.isArray(t.writingHistory))throw TypeError(".Scrap.writingHistory: array expected");for(e.writingHistory=[],n=0;n<t.writingHistory.length;++n){if("object"!==typeof t.writingHistory[n])throw TypeError(".Scrap.writingHistory: object expected");e.writingHistory[n]=i.Scrap.WritingHistory.fromObject(t.writingHistory[n])}}return e},a.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.childScraps=[],n.writingHistory=[]),e.defaults&&(n.id="",n.intendedDurationSec=0,n.synopsis="",n.prose="",n.completeness=e.enums===String?"NOT_STARTED":0),null!=t.id&&t.hasOwnProperty("id")&&(n.id=t.id),null!=t.intendedDurationSec&&t.hasOwnProperty("intendedDurationSec")&&(n.intendedDurationSec=t.intendedDurationSec),null!=t.synopsis&&t.hasOwnProperty("synopsis")&&(n.synopsis=t.synopsis),null!=t.prose&&t.hasOwnProperty("prose")&&(n.prose=t.prose),t.childScraps&&t.childScraps.length){n.childScraps=[];for(var r=0;r<t.childScraps.length;++r)n.childScraps[r]=t.childScraps[r]}if(null!=t.completeness&&t.hasOwnProperty("completeness")&&(n.completeness=e.enums===String?i.Scrap.Completeness[t.completeness]:t.completeness),t.writingHistory&&t.writingHistory.length)for(n.writingHistory=[],r=0;r<t.writingHistory.length;++r)n.writingHistory[r]=i.Scrap.WritingHistory.toObject(t.writingHistory[r],e);return n},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a.Completeness=function(){var t={},e=Object.create(t);return e[t[0]="NOT_STARTED"]=0,e[t[1]="BRAINSTORM"]=1,e[t[2]="INITIAL_DRAFT"]=2,e[t[3]="POLISHED"]=3,e[t[4]="FINAL"]=4,e}(),a.WritingHistory=function(){function a(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return a.prototype.minutesSinceEpoch=0,a.prototype.actualDurationSec=0,a.create=function(t){return new a(t)},a.encode=function(t,e){return e||(e=n.create()),null!=t.minutesSinceEpoch&&Object.hasOwnProperty.call(t,"minutesSinceEpoch")&&e.uint32(8).int32(t.minutesSinceEpoch),null!=t.actualDurationSec&&Object.hasOwnProperty.call(t,"actualDurationSec")&&e.uint32(16).int32(t.actualDurationSec),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,a=new i.Scrap.WritingHistory;t.pos<r;){var c=t.uint32();switch(c>>>3){case 1:a.minutesSinceEpoch=t.int32();break;case 2:a.actualDurationSec=t.int32();break;default:t.skipType(7&c)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.minutesSinceEpoch&&t.hasOwnProperty("minutesSinceEpoch")&&!r.isInteger(t.minutesSinceEpoch)?"minutesSinceEpoch: integer expected":null!=t.actualDurationSec&&t.hasOwnProperty("actualDurationSec")&&!r.isInteger(t.actualDurationSec)?"actualDurationSec: integer expected":null},a.fromObject=function(t){if(t instanceof i.Scrap.WritingHistory)return t;var e=new i.Scrap.WritingHistory;return null!=t.minutesSinceEpoch&&(e.minutesSinceEpoch=0|t.minutesSinceEpoch),null!=t.actualDurationSec&&(e.actualDurationSec=0|t.actualDurationSec),e},a.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.minutesSinceEpoch=0,n.actualDurationSec=0),null!=t.minutesSinceEpoch&&t.hasOwnProperty("minutesSinceEpoch")&&(n.minutesSinceEpoch=t.minutesSinceEpoch),null!=t.actualDurationSec&&t.hasOwnProperty("actualDurationSec")&&(n.actualDurationSec=t.actualDurationSec),n},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),a}(),i.WritingWorkspace=function(){function a(t){if(this.scraps=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return a.prototype.scraps=r.emptyArray,a.prototype.author="",a.prototype.contactInfo="",a.create=function(t){return new a(t)},a.encode=function(t,e){if(e||(e=n.create()),null!=t.scraps&&t.scraps.length)for(var r=0;r<t.scraps.length;++r)i.Scrap.encode(t.scraps[r],e.uint32(18).fork()).ldelim();return null!=t.author&&Object.hasOwnProperty.call(t,"author")&&e.uint32(26).string(t.author),null!=t.contactInfo&&Object.hasOwnProperty.call(t,"contactInfo")&&e.uint32(34).string(t.contactInfo),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,a=new i.WritingWorkspace;t.pos<r;){var c=t.uint32();switch(c>>>3){case 2:a.scraps&&a.scraps.length||(a.scraps=[]),a.scraps.push(i.Scrap.decode(t,t.uint32()));break;case 3:a.author=t.string();break;case 4:a.contactInfo=t.string();break;default:t.skipType(7&c)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.scraps&&t.hasOwnProperty("scraps")){if(!Array.isArray(t.scraps))return"scraps: array expected";for(var e=0;e<t.scraps.length;++e){var n=i.Scrap.verify(t.scraps[e]);if(n)return"scraps."+n}}return null!=t.author&&t.hasOwnProperty("author")&&!r.isString(t.author)?"author: string expected":null!=t.contactInfo&&t.hasOwnProperty("contactInfo")&&!r.isString(t.contactInfo)?"contactInfo: string expected":null},a.fromObject=function(t){if(t instanceof i.WritingWorkspace)return t;var e=new i.WritingWorkspace;if(t.scraps){if(!Array.isArray(t.scraps))throw TypeError(".WritingWorkspace.scraps: array expected");e.scraps=[];for(var n=0;n<t.scraps.length;++n){if("object"!==typeof t.scraps[n])throw TypeError(".WritingWorkspace.scraps: object expected");e.scraps[n]=i.Scrap.fromObject(t.scraps[n])}}return null!=t.author&&(e.author=String(t.author)),null!=t.contactInfo&&(e.contactInfo=String(t.contactInfo)),e},a.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.scraps=[]),e.defaults&&(n.author="",n.contactInfo=""),t.scraps&&t.scraps.length){n.scraps=[];for(var r=0;r<t.scraps.length;++r)n.scraps[r]=i.Scrap.toObject(t.scraps[r],e)}return null!=t.author&&t.hasOwnProperty("author")&&(n.author=t.author),null!=t.contactInfo&&t.hasOwnProperty("contactInfo")&&(n.contactInfo=t.contactInfo),n},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i})?r.apply(e,i):r)||(t.exports=a)},433:function(t,e,n){},434:function(t,e,n){},558:function(t,e){},560:function(t,e){},589:function(t,e){},590:function(t,e){},665:function(t,e){},811:function(t,e,n){"use strict";n.r(e);var r=n(1),i=n.n(r),a=n(75),c=n.n(a),o=(n(433),n(434),n(35)),s=n(829),l=n(830),u=n(102),d=n(812),p=n(839),h=n(165),f=function(){return Object(h.b)()},j=h.c,b=n(19),g=n(94),O=Object(g.b)({name:"headerOptions",initialState:{options:{currentScrapId:"",showEditLink:!1,showReadLink:!1,showPrintLink:!1,characterFilters:[],currentCharacterFilter:"",currentCompletionFilter:"",traitFilters:[],currentTraitFilter:"",isCurrentlyInSession:!1,currentWritingSessionStartEpoch:0,lastCheckedWritingSessionEpoch:0,searchModalOpen:!1,currentSearchQuery:"",currentSearchResults:[],includeTitlePage:!1}},reducers:{updateHeaderOptions:function(t,e){t.options=Object(b.a)(Object(b.a)({},t.options),e.payload)}}}),m=function(t){return t.headerOptions.options},y=O.actions.updateHeaderOptions,S=O.reducer;function v(t){var e="",n=Math.floor(t/3600);t-=3600*n,e+=n.toString().padStart(2,"0")+":";var r=Math.floor(t/60);return t-=60*r,e+=r.toString().padStart(2,"0")+":",e+=Math.round(t).toString().padStart(2,"0")}function x(t){if(!new RegExp("^[0-9:]+$").test(t))throw Error("Invalid duration string");var e=t.split(":").filter(Boolean);if(e.length>3)throw Error("Invalid duration string");for(var n=0,r=0;r<e.length;r++)n=60*n+parseInt(e[r],10);return n}var w=n(832),C=n(826),k=n(2);function I(t,e,n){return t?e.length?Object(k.jsx)("div",{style:{minHeight:"".concat(640,"px")},children:e.map((function(t){return Object(k.jsxs)("div",{style:{marginBottom:"8px",height:"".concat(120,"px"),display:"flex",flexDirection:"column"},children:[Object(k.jsx)(o.b,{to:"/scrap/"+t.scrap.id,children:Object(k.jsxs)("span",{style:{fontSize:"16px"},onClick:n,children:[t.scrap.synopsis," (",v(t.scrap.intendedDurationSec),")"]})}),Object(k.jsxs)("pre",{style:{background:"lightgrey",flex:"1",overflowY:"scroll"},children:["...",t.preview,"..."]})]})}))}):Object(k.jsx)("div",{style:{minHeight:"".concat(640,"px")},children:"No results"}):Object(k.jsx)("div",{style:{minHeight:"".concat(640,"px")},children:"\xa0"})}function D(t,e,n,r,i,a){return Object(k.jsxs)(w.a,{open:t,onClose:a,closeOnDimmerClick:!0,closeOnEscape:!0,children:[Object(k.jsx)(w.a.Header,{children:"Search"}),Object(k.jsxs)(w.a.Content,{children:[Object(k.jsx)(C.a,{style:{display:"block",marginBottom:"24px"},placeholder:"Search across all scraps",onChange:function(t){var e=function(t,e){return e.length?Object.values(t).map((function(t){if(!t.prose.toLowerCase().includes(e.toLowerCase()))return null;var n=t.prose.toLowerCase().indexOf(e.toLowerCase());return n=Math.max(0,n-30),{scrap:t,score:t.intendedDurationSec,preview:t.prose.substring(n,n+150)}})).filter(Boolean).sort((function(t,e){return e.score-t.score})).slice(0,5):[]}(r,t.target.value);i(t.target.value,e)},value:e}),I(e,n,a)]})]})}var E=n(166),T=n(23),M="scrap-ids";function P(t){return"scrap-".concat(t)}function L(){return A().map((function(t){return function(t){var e=localStorage.getItem(P(t));if(!e)throw Error("Unable to read scrap ".concat(t," from local storage"));return T.Scrap.create(JSON.parse(e))}(t)}))}function A(){var t=localStorage.getItem(M)||"[]";return JSON.parse(t)}function F(t){localStorage.setItem(M,JSON.stringify(t))}function W(t){localStorage.setItem(P(t.id),JSON.stringify(t))}function H(t){W(t);var e=A();e.push(t.id),F(e)}var N=n(26),R=n(24),B=n(17),z=n(20),U=n.n(z),J=1.0909,_="37em",G="scrapId",K="ancestorField",V="pendingDurationSecContribution",Y="durationSecContribution",Q="isScrapTrait",$="scrapTraitText",X="isScrapPlaceholder",q="scrapPlaceholderText",Z="scrapPlaceholderDurationSecField",tt="isScrapEmbedding",et="scrapLink",nt="isFountainHeader",rt="isFountainCentered",it="isFountainTransition",at="isBlank",ct="isComment",ot="isFountainCharacter",st="character",lt="isFountainDialogue",ut="isFountainParenthetical",dt="isFountainAction",pt={border:"1px solid",padding:"6em",margin:"auto",width:"49em",overflowY:"scroll",fontSize:"16px",fontFamily:"CourierPrime, Courier, monospace",flex:"1"};function ht(t,e){return Object(b.a)(Object(b.a)({},t),e)}var ft=n(12),jt=n(11),bt=n(15),gt=n(16),Ot=function(t){return t.contentState.getBlockMap().get(t.blockKey).getData().get(G)},mt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).state={isHover:!1,scrapId:Ot(t)},r}return Object(jt.a)(n,[{key:"buildScrapLinkButton",value:function(){if(!this.state.isHover)return null;var t="/scrap/".concat(this.state.scrapId);return Object(k.jsx)(o.b,{to:t,children:Object(k.jsx)(d.a,{style:{cursor:"pointer",position:"absolute",top:"-12px",right:"-20px"},circular:!0,color:"blue",icon:"edit outline"})})}},{key:"onMouseEnter",value:function(){this.setState({isHover:!0})}},{key:"onMouseLeave",value:function(){this.setState({isHover:!1})}},{key:"getParentStyle",value:function(){var t={position:"relative",paddingRight:"20px",width:_,margin:0};return this.props.isFilterSelected&&(t.backgroundColor="#f6f6c6"),this.state.isHover&&(t.backgroundColor="#c6e1f6"),t}},{key:"renderSpecific",value:function(){return Object(k.jsx)("span",{children:this.props.children})}},{key:"render",value:function(){var t=this;return Object(k.jsxs)("div",{style:this.getParentStyle(),onMouseEnter:function(){t.onMouseEnter()},onMouseLeave:function(){t.onMouseLeave()},children:[this.renderSpecific(),this.buildScrapLinkButton()]})}}]),n}(r.Component);function yt(t,e,n){t.getData().get(nt)&&e(0,t.getText().length)}function St(t){return J}var vt=function(t){return Object(k.jsx)("div",{style:{fontWeight:"bold",width:_},children:t.children})},xt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return vt(this.props)}}]),n}(mt),wt=n(32);function Ct(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&!(t.includes("|")||t.includes("@")||t.includes("#"))}var kt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"render",value:function(){var t=this,e=this.props.scrapMap[this.props.scrapId];return e?this.props.scrapId===this.props.parentScrapId?Object(k.jsx)("div",{style:{color:"red"},children:"Scraps shouldn't include themselves"}):Object(k.jsxs)("div",{style:{display:"flex"},children:[Object(k.jsx)(d.a,{icon:!0,color:"blue",onClick:function(){t.props.onGotoScrap()},children:Object(k.jsx)(u.a,{name:"angle right"})}),Object(k.jsxs)("div",{style:{marginLeft:"24px",flex:"1"},children:[Object(k.jsx)("div",{children:e.synopsis}),Object(k.jsx)("div",{children:v(e.intendedDurationSec)})]})]}):Object(k.jsxs)("div",{children:['Scrap "',this.props.scrapId,'" does not exist.']})}}]),n}(r.Component);function It(t,e,n){t.getData().get(it)&&e(0,t.getText().length)}function Dt(t){return J}var Et=function(t){return Object(k.jsx)("div",{style:{fontWeight:"bold",textAlign:"right",width:_},children:t.children})},Tt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return Et(this.props)}}]),n}(mt);function Mt(t,e,n){t.getData().get(rt)&&e(0,t.getText().length)}function Pt(t){return J}var Lt=function(t){return Object(k.jsx)("div",{style:{fontWeight:"bold",textAlign:"center",width:_},children:t.children})},At=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return Lt(this.props)}}]),n}(mt);function Ft(t,e,n){t.getData().get(ot)&&e(0,t.getText().length)}function Wt(t){return J*Math.ceil(t.length/28)}var Ht=function(t){return Object(k.jsx)("div",{style:{fontWeight:"bold",marginLeft:"12em",width:"17em"},children:t.children})},Nt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return Ht(this.props)}}]),n}(mt);function Rt(t,e,n){t.getData().get(lt)&&e(0,t.getText().length)}function Bt(t){return J*Math.ceil(t.length/36)}var zt=function(t){return Object(k.jsx)("div",{style:{marginLeft:"6em",width:"23.5em"},children:t.children})},Ut=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return zt(this.props)}}]),n}(mt);function Jt(t,e,n){t.getData().get(ut)&&e(0,t.getText().length)}function _t(t){return J*Math.ceil(t.length/30)}var Gt=function(t){return Object(k.jsx)("div",{style:{marginLeft:"8.5em",width:"19.5em"},children:t.children})},Kt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return Gt(this.props)}}]),n}(mt);function Vt(t,e,n){t.getData().get(dt)&&e(0,t.getText().length)}function Yt(t){return J*Math.ceil(t.length/56)}var Qt=function(t){return Object(k.jsx)("div",{style:{width:_},children:t.children})},$t=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){return Qt(this.props)}}]),n}(mt);function Xt(t,e,n){t.getData().get(X)&&e(0,t.getText().length)}function qt(t){var e=t.replace("{{","").replace("}}","").trim();try{return x(e.split("|")[1].trim())}catch(n){}return 0}var Zt=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){return Object(ft.a)(this,n),e.apply(this,arguments)}return Object(jt.a)(n,[{key:"renderSpecific",value:function(){var t=this.props.contentState.getBlockMap().get(this.props.blockKey).getData(),e=t.get(q),n=t.get(Z),r="".concat(e,": ").concat(v(n)),i=Math.ceil(r.length/60)+4,a=Math.ceil(n/J),c="".concat(20*a,"px"),o=Math.ceil(.01+a/i);return Object(k.jsxs)("div",{style:{height:c,background:"#afa",overflow:"hidden",position:"relative"},children:[Array(o).fill(0).map((function(){return Object(k.jsx)("div",{style:{display:"block",padding:"40px 0"},children:r})})),Object(k.jsx)("div",{style:{position:"absolute",bottom:0,width:"100%",height:"40px",background:"linear-gradient(180deg, transparent 0%, #afa 100%)",zIndex:1},children:"\xa0"})]})}}]),n}(mt);function te(t,e,n){t.getData().get(Q)&&e(0,t.getText().length)}function ee(t){if(!t)return t;var e={},n=t.getText().trim();return n.length?(function(t){return t.startsWith("/*")}(n)&&(e.isCommentStart=!0),function(t){return t.endsWith("*/")}(n)&&(e.isCommentEnd=!0)):e.isBlank=!0,t.set("data",U.a.fromJS(e))}function ne(t,e,n,r,i){if(!t)return{processProgress:r,contentBlock:t};var a=t.getData().toJS(),c=t.getText().trim(),o=!e||e.getData().get(at),s=!n||n.getData().get(at),l=e&&e.getData().get(st)||"";if(a.isBlank)o||a.isComment||(r.currentDurationSec+=J,a=ht(a,Object(B.a)({},Y,J)));else if(a.isComment||(!function(t,e,n){return t&&e&&(/^(int|ext|est|i\/e)[\s.]/i.test(n)||n.startsWith(".")&&!n.startsWith(".."))}(o,s,c)?!function(t,e,n){return t&&e&&(n.startsWith(">")&&!n.endsWith("<")||n.toUpperCase()===n&&n.endsWith("TO:"))}(o,s,c)?!function(t){return t.startsWith(">")&&t.endsWith("<")}(c)?!function(t,e,n){return t&&!e&&(n.toUpperCase()===n||n.startsWith("@"))}(o,s,c)?!function(t,e){return!!t&&(!e.startsWith("(")||!e.endsWith(")"))}(l,c)?!function(t,e){return!!t&&e.startsWith("(")&&e.endsWith(")")}(l,c)?!function(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&2===t.split("|").length}(c)?!function(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&t.includes("#")}(c)?Ct(c)||(a=ht(a,function(t){var e;return e={},Object(B.a)(e,dt,!0),Object(B.a)(e,Y,Yt(t)),e}(c)),r.currentDurationSec+=Yt(c)):a=ht(a,function(t){var e,n=t.replace("{{","").replace("}}","").trim();return e={},Object(B.a)(e,$,n),Object(B.a)(e,Q,!0),e}(c)):(a=ht(a,function(t){var e,n=t.replace("{{","").replace("}}","").trim().split("|"),r=n[0].trim(),i=0;try{i=x(n[1].trim())}catch(a){}return e={},Object(B.a)(e,q,r),Object(B.a)(e,Z,i),Object(B.a)(e,X,!0),Object(B.a)(e,Y,qt(t)),Object(B.a)(e,V,qt(t)),e}(c)),r.currentDurationSec+=qt(c)):(a=ht(a,function(t,e){var n;return n={},Object(B.a)(n,ut,!0),Object(B.a)(n,st,t),Object(B.a)(n,Y,_t(e)),n}(l,c)),r.currentDurationSec+=_t(c)):(a=ht(a,function(t,e){var n;return n={},Object(B.a)(n,lt,!0),Object(B.a)(n,st,t),Object(B.a)(n,Y,Bt(e)),n}(l,c)),r.currentDurationSec+=Bt(c)):(a=ht(a,function(t){var e,n=t.replace(/\(V\.O\.\)/i,"").replace(/\(O\.S\.\)/i,"").replace(/\(CONT'D\)/i,"").replace(/\(CONT\u2019D\)/i,"").replace(/\(PRE-LAP\)/i,"").trim();return e={},Object(B.a)(e,ot,!0),Object(B.a)(e,st,n),Object(B.a)(e,Y,Wt(t)),e}(c)),r.currentDurationSec+=Wt(c)):(a=ht(a,function(t){var e;return e={},Object(B.a)(e,rt,!0),Object(B.a)(e,Y,Pt()),e}()),r.currentDurationSec+=Pt()):(a=ht(a,function(t){var e;return e={},Object(B.a)(e,it,!0),Object(B.a)(e,Y,Dt()),e}()),r.currentDurationSec+=Dt()):(a=ht(a,function(t){var e;return e={},Object(B.a)(e,nt,!0),Object(B.a)(e,Y,St()),e}()),r.currentDurationSec+=St())),Ct(c)){a=ht(a,function(t){var e,n=t.replace("{{","").replace("}}","").trim();return e={},Object(B.a)(e,et,n),Object(B.a)(e,tt,!0),e}(c));var u=a.scrapLink;if(i[u]){r.childScraps=r.childScraps.add(u);var d=i[u];a.isComment||(r.currentDurationSec+=d.intendedDurationSec)}}var p=t.set("data",U.a.fromJS(a));var h=p.getCharacterList().map((function(t,e){return t}));return{contentBlock:p.set("characterList",h),processProgress:r}}function re(t,e,n,r){for(var i=!1,a={processStartEpoch:Date.now(),currentDurationSec:0,childScraps:U.a.OrderedSet()},c=t.getBlockMap(),o=Object(N.a)(c.keys()),s=0;s<o.length;s++){var l=o[s];c=c.set(l,ee(c.get(l)));var u=Date.now()-a.processStartEpoch;if(u>n&&(i=!0),u>r)break}for(var d=!1,p=0;p<o.length;p++){var h=o[p],f=c.get(h).getData().toJS();if(f.isCommentStart&&(d=!0),d){var j=c.get(h);f.isComment=!0;var b=U.a.fromJS(f),g=j.set("data",b);c=c.set(h,g)}f.isCommentEnd&&(d=!1);var O=Date.now()-a.processStartEpoch;if(O>n&&(i=!0),O>r)break}for(var m=0;m<o.length;m++){var y=m>0?c.get(o[m-1]):null,S=o[m],v=m+1<o.length?c.get(o[m+1]):null,x=ne(c.get(S),y,v,a,e);a=x.processProgress,c=c.set(S,x.contentBlock);var w=Date.now()-a.processStartEpoch;if(w>n&&(i=!0),w>r)break}var C=t.set("blockMap",c),k=Date.now()-a.processStartEpoch;return console.log("Update took: "+k),{contentState:C,totalDurationSec:a.currentDurationSec,childScraps:a.childScraps,showTimeoutWarning:i}}function ie(t,e,n){var r,i=(null===(r=n[t])||void 0===r?void 0:r.prose)||"",a=[].concat(Object(N.a)(e),[t]),c=re(R.ContentState.createFromText(i),n,500,5e3),o=[];return c.contentState.getBlocksAsArray().forEach((function(r){var i=r.getData();if(!i.get(ct))if(i.get(tt)){var c=i.get(et);if(n[c]){if(a.includes(c))throw Error("Replacing scrap ".concat(c," would cause infinite recursion"));var s=ie(c,a,n);o.push.apply(o,Object(N.a)(s))}}else{var l=r.set("data",i.set(G,t).set(K,e));o.push(l)}})),o}var ae=n(828),ce=n(415),oe=n(50);function se(t){return new Date(6e4*t).toLocaleDateString()}function le(t){return"".concat(t,"%")}oe.c.register.apply(oe.c,Object(N.a)(oe.j));var ue=function(){function t(e,n,r,i,a){Object(ft.a)(this,t),this.headerText=void 0,this.id=void 0,this.startSec=void 0,this.durationSec=void 0,this.characters=void 0,this.completeness=void 0,this.traits=void 0,this.headerText=e,this.id=n,this.startSec=r,this.durationSec=i,this.characters=new Set,this.completeness=a,this.traits=new Set}return Object(jt.a)(t,[{key:"render",value:function(t,e,n,r){var i,a="grey";switch((this.characters.has(e)||this.traits.has(r))&&(a="#D2042D"),this.completeness){case T.Scrap.Completeness.FINAL:i="Final";break;case T.Scrap.Completeness.POLISHED:i="Polished";break;case T.Scrap.Completeness.INITIAL_DRAFT:i="Initial Draft";break;case T.Scrap.Completeness.BRAINSTORM:i="Brainstorm";break;default:i="Not Started"}var c=v(this.durationSec)+" (".concat(i,")");if(n)switch(this.completeness){case T.Scrap.Completeness.FINAL:a="#228B22";break;case T.Scrap.Completeness.POLISHED:a="#C9CC3F";break;case T.Scrap.Completeness.INITIAL_DRAFT:a="#FFC300";break;case T.Scrap.Completeness.BRAINSTORM:a="#FF5F1F";break;default:a="#D2042D"}return Object(k.jsx)(ae.a,{content:c,header:this.headerText,mouseEnterDelay:50,mouseLeaveDelay:50,trigger:Object(k.jsx)(o.b,{to:"/scrap/"+this.id,style:{cursor:"pointer",display:"inline-block",height:"100%",boxShadow:"inset 0px 0px 0px 1px #555",position:"absolute",width:le(100*this.durationSec/t),left:le(100*this.startSec/t),background:a,zIndex:2},children:Object(k.jsx)("div",{children:"\xa0"})})},"key-"+this.id)}}]),t}(),de=function(){function t(){Object(ft.a)(this,t),this.blocks=[]}return Object(jt.a)(t,[{key:"lastBlockId",value:function(){return this.blocks.length?this.blocks[this.blocks.length-1].id:""}},{key:"render",value:function(t,e,n,r,i){return Object(k.jsx)("div",{style:{position:"relative",width:le(e),height:"40px",borderBottom:"1px solid"},children:this.blocks.map((function(e){return e.render(t,n,r,i)}))})}}]),t}(),pe=function(){function t(e,n,r){if(Object(ft.a)(this,t),this.isValid=!1,this.durationSec=0,this.percentComplete=0,this.rows=[],n[e]){var i=fe(r,n);this.durationSec=i.totalDurationSec,this.percentComplete=i.percentComplete,this.durationSec&&(this.isValid=!0,this.rows=i.rows)}}return Object(jt.a)(t,[{key:"getSecondMarkers",value:function(t){for(var e=Math.round(t/100*4)+1,n=this.durationSec/(e-1),r=0,i=[],a=0;a<e;a++){var c=Math.round(r);i.push(c),r+=n}return i}},{key:"render",value:function(t,e,n,r){var i=this,a=this.getSecondMarkers(t),c=41*this.rows.length;return Object(k.jsxs)("div",{style:{width:"100%",overflowX:"scroll",background:"lightgrey"},children:[this.rows.map((function(a){return a.render(i.durationSec,t,e,n,r)})),Object(k.jsx)("div",{style:{height:"24px",position:"relative",width:le(t),background:"white"},children:a.map((function(t,e){var n={display:"inline-block",position:"absolute",fontSize:"16px",fontFamily:"CourierPrime, Courier, monospace",paddingTop:"".concat(c,"px"),top:"-".concat(c,"px")};return e+1===a.length?(n.paddingRight="8px",n.textAlign="right",n.borderRight="2px solid",n.right=le(100-100*t/i.durationSec)):(n.paddingLeft="8px",n.textAlign="left",n.borderLeft="2px solid",n.left=le(100*t/i.durationSec)),Object(k.jsx)("div",{style:n,children:v(t)})}))})]})}}]),t}(),he=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).state=r.initializeState(t),r}return Object(jt.a)(n,[{key:"initializeState",value:function(t){return{scrapId:t.scrapId,timeline:new pe(t.scrapId,t.scrapMap,t.parsedContentBlocks),zoomLevel:100,chartMinimized:!0,timelineMinimized:!1}}},{key:"zoomIn",value:function(){this.setState({zoomLevel:2*this.state.zoomLevel})}},{key:"zoomOut",value:function(){this.setState({zoomLevel:Math.max(100,this.state.zoomLevel/2)})}},{key:"flipTimelineMinimization",value:function(){this.setState({timelineMinimized:!this.state.timelineMinimized})}},{key:"flipChartMinimization",value:function(){this.setState({chartMinimized:!this.state.chartMinimized})}},{key:"getProgressChart",value:function(){var t;if(this.state.chartMinimized)return null;var e=(null===(t=this.props.scrapMap[this.state.scrapId])||void 0===t?void 0:t.writingHistory)||[];if(!e.length)return Object(k.jsx)("div",{children:"No writing history"});if(1===e.length)return Object(k.jsxs)("div",{children:[se(e[0].minutesSinceEpoch),": ",e[0].actualDurationSec/60]});for(var n=e[0].minutesSinceEpoch,r=e[e.length-1].minutesSinceEpoch,i={},a=n;a<=r;a+=1440)i[se(a)]=null;for(var c=0;c<e.length;c++){i[se(e[c].minutesSinceEpoch)]=e[c].actualDurationSec/60}for(var o=[],s=[],l=n;l<=r;l+=1440){var u=se(l),d=i[u];o.push(u),s.push(d)}var p={labels:o,datasets:[{data:s}]};return Object(k.jsxs)("div",{children:[Object(k.jsx)("div",{style:{position:"relative",height:"300px"},children:Object(k.jsx)(ce.a,{height:"300px",options:{responsive:!0,plugins:{title:{display:!0,text:"Progress over Time"},legend:{display:!1}},scales:{y:{title:{display:!0,text:"Pages complete"},type:"linear",display:!0,position:"left"}},maintainAspectRatio:!1},data:p})}),Object(k.jsx)("pre",{children:JSON.stringify(e,null,4)})]})}},{key:"render",value:function(){var t=this;if(!this.state.timeline.isValid)return Object(k.jsx)("div",{children:"... loading timeline... "});var e=this.state.timelineMinimized?null:Object(k.jsxs)("div",{style:{display:"inline-block"},children:[Object(k.jsx)(d.a,{onClick:function(){return t.zoomOut()},disabled:100===this.state.zoomLevel,icon:!0,children:Object(k.jsx)(u.a,{name:"zoom-out"})}),Object(k.jsx)(d.a,{onClick:function(){return t.zoomIn()},icon:!0,children:Object(k.jsx)(u.a,{name:"zoom-in"})})]});return Object(k.jsxs)("div",{children:[Object(k.jsxs)("div",{style:{marginBottom:"12px",display:"flex"},children:[e,Object(k.jsx)("span",{style:{flex:"1"},children:"\xa0"}),Object(k.jsxs)("span",{style:{margin:"auto 12px"},children:["Percent complete: ",this.state.timeline.percentComplete]}),Object(k.jsx)(d.a,{icon:!0,title:"Toggle Chart",onClick:function(){t.flipChartMinimization()},children:Object(k.jsx)(u.a,{name:"chart line"})}),Object(k.jsx)(d.a,{onClick:function(){return t.flipTimelineMinimization()},icon:!0,children:Object(k.jsx)(u.a,{name:this.state.timelineMinimized?"window maximize outline":"window minimize outline"})})]}),Object(k.jsx)("div",{children:this.getProgressChart()}),this.state.timelineMinimized?null:this.state.timeline.render(this.state.zoomLevel,this.props.currentCharacterFilter,!!this.props.currentCompletionFilter,this.props.currentTraitFilter)]})}}]),n}(r.Component);function fe(t,e){for(var n=[],r=0,i=0,a=0;a<t.length;a++){for(var c=t[a].getData().get(Y)||0,o=t[a].getData().get(V)||0,s=t[a].getData().get(st)||null,l=(t[a].getData().get($)||"").split("#").filter(Boolean).map((function(t){return t.trim()})),u=[].concat(Object(N.a)(t[a].getData().get(K)||[]),[t[a].getData().get(G)||""]),d=function(t){n.length<=t&&n.push(new de);var i=n[t].lastBlockId();u[t]===i?n[t].blocks[n[t].blocks.length-1].durationSec+=c:n[t].blocks.push(new ue(je(u[t],e),u[t],r,c,be(u[t],e))),s&&n[t].blocks[n[t].blocks.length-1].characters.add(s),l.forEach((function(e){n[t].blocks[n[t].blocks.length-1].traits.add(e)}))},p=0;p<u.length;p++)d(p);r+=c,i+=o}return{totalDurationSec:r,totalCompletedSec:r-i,percentComplete:Math.ceil(1e3*(1-i/r))/10,rows:n}}function je(t,e){var n;return(null===(n=e[t])||void 0===n?void 0:n.synopsis)||""}function be(t,e){var n;return(null===(n=e[t])||void 0===n?void 0:n.completeness)||T.Scrap.Completeness.NOT_STARTED}T.Scrap.WritingHistory;var ge=function(){var t={scrapMap:{}};return L().forEach((function(e){t.scrapMap[e.id]=e.toJSON()})),t}(),Oe="scrapList",me=Object(g.b)({name:Oe,initialState:ge,reducers:{createScrap:function(t,e){t.scrapMap[e.payload.id]=e.payload},updateScrap:function(t,e){var n=e.payload;n.writingHistory=n.writingHistory||[];var r=n.writingHistory,i=0;r.length&&(i=r[r.length-1].minutesSinceEpoch);var a=Math.floor(Date.now()/6e4);if(a-i>5){var c=fe(ie(n.id,[],t.scrapMap),t.scrapMap),o={minutesSinceEpoch:a,actualDurationSec:Math.floor(c.totalCompletedSec)};a-i>60?n.writingHistory.push(o):n.writingHistory[r.length-1]=o}t.scrapMap[e.payload.id]=n},removeScrap:function(t,e){delete t.scrapMap[e.payload]}}}),ye=function(t){return function(t){return function(e){var n=t(e);return e.type.startsWith("scrapList/")&&Se(e),n}}},Se=function(t){switch(t.type){case"".concat(Oe,"/createScrap"):H(t.payload);break;case"".concat(Oe,"/updateScrap"):W(t.payload);break;case"".concat(Oe,"/removeScrap"):e=t.payload,F(A().filter((function(t){return t!==e}))),localStorage.removeItem(P(e))}var e},ve=function(t){for(var e={},n=0,r=Object.entries(t.scrapList.scrapMap);n<r.length;n++){var i=Object(E.a)(r[n],2),a=i[0],c=i[1];e[a]=T.Scrap.fromObject(c)}return e},xe=me.actions,we=xe.createScrap,Ce=xe.updateScrap,ke=xe.removeScrap,Ie=me.reducer;function De(){var t,e,n,r,i,a,c,h,b=f(),g=j(m),O=j(ve),S=function(t){b(y(t))};if(g.characterFilters.length&&!g.showReadLink){var x=g.characterFilters.map((function(t){return{key:t.character,text:"".concat(t.character," (").concat(Math.round(1e3*t.percentDurationSec)/10,"%)"),value:t.character}}));x.unshift({key:"none",value:"No Character Filter",text:"No Character Filter"}),t=Object(k.jsx)(s.a,{text:g.currentCharacterFilter||"Filter by character",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:g.currentCharacterFilter,options:x,onChange:function(t,e){S({currentCharacterFilter:e.value,currentCompletionFilter:"",currentTraitFilter:""})}})}if(g.showReadLink||(e=Object(k.jsx)(s.a,{text:g.currentCompletionFilter||"Filter by completion",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:g.currentCompletionFilter,options:[{key:"none",value:"",text:"No Completion Filter"},{key:"pending",value:"Pending Completion",text:"Show Completion"}],onChange:function(t,e){S({currentCharacterFilter:"",currentTraitFilter:"",currentCompletionFilter:e.value})}})),g.traitFilters.length&&!g.showReadLink){var w=g.traitFilters.map((function(t){return{key:t.trait,text:"".concat(t.trait," (").concat(t.numberOfAppearances,")"),value:t.trait}}));w.unshift({key:"none",value:"No Trait Filter",text:"No Trait Filter"}),n=Object(k.jsx)(s.a,{text:g.currentTraitFilter||"Filter by trait",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:g.currentTraitFilter,options:w,onChange:function(t,e){S({currentCharacterFilter:"",currentTraitFilter:e.value,currentCompletionFilter:""})}})}g.showEditLink&&(r=Object(k.jsx)(o.b,{to:"/scrap/"+g.currentScrapId,children:Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(u.a,{name:"edit"})})})),g.showReadLink&&(i=Object(k.jsx)(o.b,{to:"/read/"+g.currentScrapId,children:Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(u.a,{name:"film"})})})),g.showPrintLink&&(a=Object(k.jsx)(o.b,{to:"/print/"+g.currentScrapId,children:Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(u.a,{name:"print"})})})),g.showPrintLink&&(c=g.isCurrentlyInSession?Object(k.jsxs)(l.a.Item,{children:[v((Date.now()-g.currentWritingSessionStartEpoch)/1e3)," spent writing"]}):Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(d.a,{onClick:function(){S({isCurrentlyInSession:!0,currentWritingSessionStartEpoch:Date.now(),lastCheckedWritingSessionEpoch:Date.now()}),setInterval((function(){S({lastCheckedWritingSessionEpoch:Date.now()})}),1e3)},children:"Start writing session"})})),g.showPrintLink||(h=Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(p.a,{onChange:function(t,e){S({includeTitlePage:e.checked})},checked:g.includeTitlePage,label:"Include title page"})}));var C=D(g.searchModalOpen,g.currentSearchQuery,g.currentSearchResults,O,(function(t,e){S({currentSearchQuery:t,currentSearchResults:e})}),(function(){S({searchModalOpen:!1})}));return Object(k.jsxs)(l.a,{children:[Object(k.jsx)(o.b,{to:"/",children:Object(k.jsx)(l.a.Item,{header:!0,children:"Revision"})}),Object(k.jsx)(o.b,{to:"/data",children:Object(k.jsx)(l.a.Item,{children:Object(k.jsx)(u.a,{name:"save"})})}),Object(k.jsx)(l.a.Item,{onClick:function(){S({searchModalOpen:!0})},children:Object(k.jsx)(u.a,{name:"search"})}),C,c,h,Object(k.jsxs)(l.a.Menu,{position:"right",children:[e,n,t,r,i,a]})]})}var Ee=n(836),Te=n(833),Me=n(837),Pe=n(831),Le=n(834),Ae="workspace-author",Fe="workspace-contact-info";function We(){return{author:localStorage.getItem(Ae)||"",contactInfo:localStorage.getItem(Fe)||""}}function He(t){localStorage.setItem(Ae,t)}function Ne(t){localStorage.setItem(Fe,t)}var Re=We(),Be="workspaceContactInfo",ze=Object(g.b)({name:Be,initialState:Re,reducers:{updateAuthor:function(t,e){t.author=e.payload},updateContactInfo:function(t,e){t.contactInfo=e.payload}}}),Ue=function(t){return function(t){return function(e){var n=t(e);return e.type.startsWith("workspaceContactInfo/")&&Je(e),n}}},Je=function(t){switch(t.type){case"".concat(Be,"/updateAuthor"):He(t.payload);break;case"".concat(Be,"/updateContactInfo"):Ne(t.payload)}},_e=function(t){return t.workspaceContactInfo},Ge=ze.actions,Ke=Ge.updateAuthor,Ve=Ge.updateContactInfo,Ye=ze.reducer;function Qe(t){var e=Object.values(t),n={};if(e.forEach((function(t){t.childScraps.forEach((function(t){n[t]=!0}))})),!e.length)return Object(k.jsx)(Ee.a,{children:"Whoops, no scraps yet"});var r=e.filter((function(t){return!n[t.id]})).sort((function(t,e){return e.intendedDurationSec-t.intendedDurationSec}));return Object(k.jsx)(Ee.a,{style:{display:"flex",flexWrap:"wrap"},children:r.map((function(t,e){return Object(k.jsx)(o.b,{to:"/read/"+t.id,children:Object(k.jsxs)(Te.a,{style:{margin:"8px"},children:[Object(k.jsx)(Te.a.Content,{header:t.synopsis}),Object(k.jsx)(Te.a.Content,{children:Object(k.jsx)("p",{children:v(t.intendedDurationSec)})})]})},e)}))})}function $e(){var t=f(),e=Object(wt.f)(),n=j(ve),r=j(_e);return Object(k.jsxs)("div",{style:{margin:"24px"},children:[Object(k.jsx)(Ee.a.Group,{children:Object(k.jsxs)(Ee.a,{children:[Object(k.jsxs)(Me.a,{size:"medium",children:["About You",Object(k.jsx)(Me.a.Subheader,{children:"Your name / contact info (will be on PDFs you download)"})]}),Object(k.jsxs)(Pe.a,{children:[Object(k.jsx)(Pe.a.Input,{label:"Author",defaultValue:r.author,onChange:function(e){t(Ke(e.target.value))}}),Object(k.jsx)(Pe.a.TextArea,{label:"Contact Info",defaultValue:r.contactInfo,onChange:function(e){t(Ve(e.target.value))},rows:2})]})]})}),Object(k.jsxs)(Ee.a.Group,{children:[Object(k.jsxs)(Ee.a,{style:{display:"flex"},children:[Object(k.jsxs)(Me.a,{size:"medium",children:["Scrap List",Object(k.jsx)(Me.a.Subheader,{children:"All your top-level scraps (no parents)"})]}),Object(k.jsx)("div",{style:{flex:1,textAlign:"right"},children:Object(k.jsx)(d.a,{icon:!0,color:"green",onClick:function(){var n=T.Scrap.create({id:Object(Le.a)(),synopsis:"Story Content",prose:"Here is where you can summarize the story, and start to structure / brainstorm\nFeel free to create new scraps for alternative starting points, or new supporting docs for this story."}).toJSON();t(we(n)),e.push("/scrap/".concat(n.id))},children:Object(k.jsx)(u.a,{name:"add"})})})]}),Qe(n)]})]})}var Xe=n(402),qe=n(34),Ze=n.n(qe),tn=n(403),en=n.n(tn);function nn(){var t="writing_workspace_"+Date.now()+".write";en()(function(){var t=We(),e=T.WritingWorkspace.create({author:t.author,contactInfo:t.contactInfo,scraps:L()});return T.WritingWorkspace.encode(e).finish()}(),t)}function rn(){return(rn=Object(Xe.a)(Ze.a.mark((function t(e){var n;return Ze.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e[0].arrayBuffer();case 4:n=t.sent,an(new Uint8Array(n)),window.location.reload();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function an(t){var e,n=T.WritingWorkspace.decode(t);localStorage.clear(),n.scraps.forEach((function(t){H(t)})),He((e={author:n.author,contactInfo:n.contactInfo}).author),Ne(e.contactInfo)}function cn(){var t=j(ve);return Object(k.jsx)("div",{style:{margin:"24px"},children:Object(k.jsxs)(Ee.a.Group,{children:[Object(k.jsx)(Ee.a,{style:{display:"flex"},children:Object(k.jsxs)(Me.a,{size:"medium",children:["Data Management",Object(k.jsx)(Me.a.Subheader,{children:"Load, Save, or Clear your Workspace"})]})}),Object(k.jsxs)(Ee.a,{children:[Object.keys(t).length," Scraps"]}),Object(k.jsxs)(Ee.a,{children:[Object(k.jsx)(d.a,{icon:!0,color:"green",title:"Download Workspace",onClick:function(){nn()},children:Object(k.jsx)(u.a,{name:"download"})}),Object(k.jsx)(d.a,{icon:!0,color:"red",title:"Clear Workspace",onClick:function(){localStorage.clear(),window.location.reload()},children:Object(k.jsx)(u.a,{name:"file text outline"})})]}),Object(k.jsxs)(Ee.a,{children:[Object(k.jsx)(Me.a,{size:"small",children:"Upload Workspace"}),Object(k.jsx)("input",{type:"file",accept:".write",onChange:function(t){return function(t){return rn.apply(this,arguments)}(t.target.files)}})]})]})})}n(553);var on=n(404),sn=n.n(on),ln=n(187),un=n.n(ln),dn=n(405),pn=new R.CompositeDecorator([{strategy:Xt,component:function(t){return Object(k.jsx)("div",{style:{background:"#050",color:"white",display:"flex",padding:"8px"},children:Object(k.jsx)("div",{style:{flex:1},children:t.children})})}},{strategy:te,component:function(t){return Object(k.jsx)("div",{style:{background:"#c00",color:"white",display:"flex",padding:"8px"},children:Object(k.jsx)("div",{style:{flex:1},children:t.children})})}},{strategy:function(t,e,n){t.getData().get(tt)&&e(0,t.getText().length)},component:function(t){var e=t.contentState.getBlockMap().get(t.blockKey).getData(),n=e.get(et),r=e.get(ct),i=j(ve),a=Object(wt.f)(),c=Object(wt.g)(),o=c.pathname.replace("/scrap/",""),s=r?"#cfead9":"#555";return Object(k.jsxs)("div",{style:{background:s,fontWeight:"bold",display:"flex",flexDirection:"column",padding:"8px"},children:[Object(k.jsx)("div",{style:{color:"white"},children:t.children}),Object(k.jsx)("div",{style:{flex:"1",cursor:"pointer",padding:"8px",border:"1px solid",background:"white",fontWeight:"normal"},children:Object(k.jsx)(kt,{parentScrapId:o,scrapId:n,scrapMap:i,onGotoScrap:function(){a.push("/scrap/".concat(n))}})})]})}},{strategy:yt,component:vt},{strategy:It,component:Et},{strategy:Mt,component:Lt},{strategy:Ft,component:Ht},{strategy:Rt,component:zt},{strategy:Jt,component:Gt},{strategy:function(t,e,n){t.getData().get(ct)&&!t.getData().get(tt)&&e(0,t.getText().length)},component:function(t){return Object(k.jsx)("div",{style:{fontStyle:"italic",background:"#cfead9",width:_},children:t.children})}},{strategy:Vt,component:Qt}]),hn=new R.CompositeDecorator([{strategy:Xt,component:Zt},{strategy:te,component:function(t){return null}},{strategy:yt,component:xt},{strategy:It,component:Tt},{strategy:Mt,component:At},{strategy:Ft,component:function(t){var e=!1;return j(m).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(st)&&(e=!0),Object(k.jsx)(Nt,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:Rt,component:function(t){var e=!1;return j(m).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(st)&&(e=!0),Object(k.jsx)(Ut,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:Jt,component:function(t){var e=!1;return j(m).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(st)&&(e=!0),Object(k.jsx)(Kt,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:Vt,component:$t}]);function fn(t){var e=un()(t);return e?e.map((function(t){return t.getText()})).join("\n"):""}function jn(t,e,n,r,i){e.preventDefault();var a=fn(r);dn.a(a).then((function(){if(n){var t=R.Modifier.replaceText(r.getCurrentContent(),r.getSelection(),"");i({editorState:R.EditorState.set(r,{currentContent:t})})}}))}function bn(t){return{editorState:gn(t),lastEmittedStr:"",scrapId:t.scrapId,durationErrorString:null,actualDurationSec:0,parentScrapIds:On(t),parseErrorState:!1,durationInputKey:"duration-key-"+Date.now(),focusMode:!1}}function gn(t){var e=t.scrapMap[t.scrapId];return e?R.EditorState.createWithContent(R.ContentState.createFromText(e.prose),pn):R.EditorState.createEmpty()}function On(t){var e=t.scrapMap[t.scrapId],n=[];for(var r in t.scrapMap){var i=t.scrapMap[r];i.childScraps.includes(e.id)&&n.push(i.id)}return n}var mn=n(263),yn=n(827),Sn=n(264);function vn(t,e){var n,r=t.map((function(t){return e[t]})).filter(Boolean),i=r.map((function(t){return Object(k.jsx)(mn.a,{link:!0,children:Object(k.jsx)(o.b,{to:"/scrap/"+t.id,children:t.synopsis})})}));return n=r.length?Object(k.jsxs)("div",{children:["Scraps:",Object(k.jsx)(yn.a,{children:i.reduce((function(t,e){return[t,Object(k.jsx)(Sn.a,{icon:"right chevron"}),e]}))})]}):Object(k.jsx)("div",{children:"No parent scraps"}),Object(k.jsx)("div",{children:n})}function xn(t,e,n,r){var i=e.parseErrorState?Object(k.jsx)("div",{style:{color:"red"},children:"Parsing took too long, please break into smaller chunks"}):null,a=e.focusMode?"Focus Off":"Focus On",c=e.focusMode?"expand arrows alternate":"crosshairs",o=e.actualDurationSec,s=t.scrapMap[t.scrapId].intendedDurationSec,l=s>0?"".concat(Math.ceil(1e3*o/s)/10,"% Complete"):"";return Object(k.jsxs)("div",{children:[Object(k.jsxs)("div",{style:{display:"flex"},children:[Object(k.jsx)(d.a,{icon:!0,title:"Add child scrap",onClick:function(){return function(t,e,n,r){var i=t.getSelection(),a=fn(t),c=Object(Le.a)(),o=T.Scrap.create({id:c,synopsis:"New Scrap created in editor",prose:"this has placeholder content for now"});a.trim().length&&(o.prose=a),e(o);var s="\n{{"+c+"}}\n",l=i.isCollapsed()?R.Modifier.insertText(t.getCurrentContent(),i,s):R.Modifier.replaceText(t.getCurrentContent(),i,s);n({editorState:R.EditorState.createWithContent(R.ContentState.createFromText(l.getPlainText()),pn)},(function(){r()}))}(e.editorState,t.onScrapCreate,(function(t,e){r(t,e)}),(function(){return n()}))},children:Object(k.jsx)(u.a,{name:"add"})}),Object(k.jsx)(d.a,{icon:!0,title:"Replace placeholder scraps",onClick:function(){return function(t,e,n,r){for(var i,a=t.getSelection(),c=fn(t),o=c,s=new RegExp("{{([^}]+)}}","g");i=s.exec(c);){var l=i[0],u=i[1].split("|");if(2===u.length){var d=0;try{d=x(u[1].trim())}catch(f){}var p=Object(Le.a)();e(T.Scrap.create({id:p,synopsis:u[0].trim(),prose:l,intendedDurationSec:d})),o=o.replace(l,"\n{{"+p+"}}\n")}}var h=R.Modifier.replaceText(t.getCurrentContent(),a,o);n({editorState:R.EditorState.createWithContent(R.ContentState.createFromText(h.getPlainText()),pn)},(function(){r()}))}(e.editorState,t.onScrapCreate,(function(t,e){r(t,e)}),(function(){return n()}))},children:Object(k.jsx)(u.a,{name:"cogs"})}),Object(k.jsx)(d.a,{icon:!0,title:"Absorb selected scraps",onClick:function(){return function(t,e,n,r,i,a){for(var c,o=e.getSelection(),s=fn(e),l=s,u=[],d=new RegExp("{{([^}]+)}}","g");c=d.exec(s);){var p=c[0],h=c[1].trim(),f=n[h];f&&(l=l.replace(p,f.prose),u.push(h))}var j={};Object.values(n).forEach((function(e){e.id!==t&&e.childScraps.forEach((function(t){j[t]=!0}))})),u.filter((function(t){return!j[t]})).forEach((function(t){r(t)}));var b=R.Modifier.replaceText(e.getCurrentContent(),o,l);i({editorState:R.EditorState.createWithContent(R.ContentState.createFromText(b.getPlainText()),pn)},(function(){a()}))}(t.scrapId,e.editorState,t.scrapMap,t.onScrapDelete,(function(t,e){r(t,e)}),(function(){return n()}))},children:Object(k.jsx)(u.a,{name:"sitemap"})}),Object(k.jsx)(d.a,{icon:!0,title:"Generate placeholders from selected lines",onClick:function(){return function(t,e,n,r,i){var a=n.getSelection(),c=fn(n).split("\n").map((function(t){return t.trim()})).filter(Boolean),o=Math.floor(e/c.length),s=c.map((function(t){return"{{".concat(t,"|").concat(o,"}}")})).join("\n\n"),l=R.Modifier.replaceText(n.getCurrentContent(),a,s);r({editorState:R.EditorState.createWithContent(R.ContentState.createFromText(l.getPlainText()),pn)},(function(){i()}))}(t.scrapId,s,e.editorState,(function(t,e){r(t,e)}),(function(){return n()}))},children:Object(k.jsx)(u.a,{name:"list ul"})}),Object(k.jsx)(d.a,{icon:!0,disabled:s<=0,title:"Resize placeholders to fill",onClick:function(){return function(t,e,n,r,i,a){for(var c,o=r.getCurrentContent().getPlainText(),s=o,l=0,u=new RegExp("{{([^}]+)}}","g");c=u.exec(o);){var d=c[1].split("|");if(2===d.length)try{l+=x(d[1].trim())}catch(b){}}var p=(e-(n-l))/l;for(u=new RegExp("{{([^}]+)}}","g");c=u.exec(o);){var h=c[0],f=c[1].split("|");if(2===f.length)try{var j=x(f[1].trim());j=Math.round(j*p),s=s.replace(h,"{{"+f[0]+"|"+v(j)+"}}")}catch(g){}}i({editorState:R.EditorState.createWithContent(R.ContentState.createFromText(s),pn)},(function(){a()}))}(t.scrapId,s,o,e.editorState,(function(t,e){r(t,e)}),(function(){return n()}))},children:Object(k.jsx)(u.a,{name:"resize vertical"})}),Object(k.jsx)("span",{style:{flex:1},children:"\xa0"}),Object(k.jsx)("span",{style:{margin:"auto 24px"},children:l}),Object(k.jsx)(d.a,{icon:!0,title:a,onClick:function(){r({focusMode:!e.focusMode},(function(){}))},children:Object(k.jsx)(u.a,{name:c})})]}),i]})}function wn(t,e,n,r){return Object(k.jsx)(Ee.a,{children:Object(k.jsx)(Pe.a,{children:Object(k.jsxs)("div",{style:{display:"flex"},children:[Object(k.jsx)("div",{style:{flex:1,margin:"16px 0"},children:Object(k.jsx)(Pe.a.Input,{label:"Synopsis",defaultValue:t.synopsis,onChange:function(t){var e=n.scrapMap[n.scrapId];e.synopsis=t.target.value,n.onScrapUpdate(e)}})}),Object(k.jsx)("div",{style:{flex:1,margin:"16px"},children:Object(k.jsx)(Pe.a.Input,{style:{flex:1},label:"Intended Duration (HH:MM:SS)",defaultValue:v(t.intendedDurationSec),error:e.durationErrorString,onChange:function(t){!function(t,e,n){var r;try{r=x(t)}catch(a){return Cn(!0,n)}var i=e.scrapMap[e.scrapId];i.intendedDurationSec=r,e.onScrapUpdate(i),Cn(!1,n)}(t.target.value,n,r)}},e.durationInputKey)}),Object(k.jsx)("div",{style:{flex:1,margin:"16px auto"},children:Object(k.jsxs)(Pe.a.Field,{children:[Object(k.jsx)("label",{children:"Completeness"}),Object(k.jsx)(s.a,{selection:!0,options:[{key:"not_started",text:"Not Started",value:T.Scrap.Completeness.NOT_STARTED},{key:"brainstorm",text:"Brainstorm",value:T.Scrap.Completeness.BRAINSTORM},{key:"draft",text:"Initial Draft",value:T.Scrap.Completeness.INITIAL_DRAFT},{key:"polished",text:"Polished",value:T.Scrap.Completeness.POLISHED},{key:"final",text:"Final",value:T.Scrap.Completeness.FINAL}],value:t.completeness||T.Scrap.Completeness.NOT_STARTED,onChange:function(t,e){var r=n.scrapMap[n.scrapId];r.completeness=e.value,n.onScrapUpdate(r)}})]})}),Object(k.jsx)("div",{style:{flex:1,margin:"auto"},children:Object(k.jsxs)(Pe.a.Field,{children:[Object(k.jsxs)("label",{children:["Current Actual Duration: ",v(e.actualDurationSec)]}),Object(k.jsx)(d.a,{onClick:function(){!function(t,e,n){var r=t.scrapMap[t.scrapId];r.intendedDurationSec=e.actualDurationSec,t.onScrapUpdate(r),n({durationInputKey:"duration-key-"+Date.now()},(function(){Cn(!1,n)}))}(n,e,r)},disabled:e.actualDurationSec===t.intendedDurationSec,children:"Update expected duration"})]})})]})})})}function Cn(t,e){e({durationErrorString:t?"Please enter a duration of format HH:MM:SS":null},(function(){}))}var kn={GREEN:{color:"green"}},In=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).domEditor=void 0,r.remapEditorContent=sn()((function(){var t=r.state.editorState.getCurrentContent().getPlainText();if(t!==r.state.lastEmittedStr){r.persistProse(t);var e=re(r.state.editorState.getCurrentContent(),r.props.scrapMap,50,500),n=r.props.scrapMap[r.props.scrapId];if(!function(t,e){if(t.size!==e.length)return!1;for(var n=0;n<e.length;n++)if(!t.includes(e[n]))return!1;return!0}(e.childScraps,n.childScraps)){var i=T.Scrap.create(Object(b.a)(Object(b.a)({},n),{},{childScraps:Object(N.a)(e.childScraps.toArray())}));r.props.onScrapUpdate(i)}r.setState({editorState:R.EditorState.set(r.state.editorState,{currentContent:e.contentState}),lastEmittedStr:t,actualDurationSec:Math.round(e.totalDurationSec),parseErrorState:e.showTimeoutWarning})}}),200),r.state=bn(t),r.remapEditorContent(),r}return Object(jt.a)(n,[{key:"setHeaderOptions",value:function(){this.props.onUpdateHeaderOptions(Object(b.a)(Object(b.a)({},this.props.headerOptions),{},{currentScrapId:this.props.scrapId,showReadLink:!0,showEditLink:!1,showPrintLink:!0,characterFilters:[],currentCharacterFilter:"",currentCompletionFilter:"",traitFilters:[],currentTraitFilter:""}))}},{key:"componentDidMount",value:function(){this.setHeaderOptions()}},{key:"componentDidUpdate",value:function(t,e,n){this.state.scrapId!==this.props.scrapId&&(this.setHeaderOptions(),this.setState(bn(this.props)),this.remapEditorContent())}},{key:"setDomEditorRef",value:function(t){this.domEditor=t}},{key:"focus",value:function(){this.domEditor.focus()}},{key:"onProseChange",value:function(t){this.setState({editorState:t}),this.remapEditorContent()}},{key:"persistProse",value:function(t){var e=this.props.scrapMap[this.props.scrapId];e.prose=t,this.props.onScrapUpdate(e)}},{key:"render",value:function(){var t=this,e=this.props.scrapMap[this.props.scrapId];if(!e)return Object(k.jsx)("div",{children:"Whoops, could not find scrap"});var n=null;return this.state.focusMode||(n=Object(k.jsxs)("div",{children:[vn(this.state.parentScrapIds,this.props.scrapMap),wn(e,this.state,this.props,(function(e,n){t.setState(e,n)}))]})),Object(k.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[n,xn(this.props,this.state,this.remapEditorContent,(function(e,n){t.setState(e,n)})),Object(k.jsx)("div",{onClick:function(){t.focus()},style:pt,children:Object(k.jsx)(R.Editor,{customStyleMap:kn,spellCheck:!0,stripPastedStyles:!0,onCut:function(e,n){jn(0,n,!0,t.state.editorState,(function(e){t.setState(e)}))},onCopy:function(e,n){jn(0,n,!1,t.state.editorState,(function(e){t.setState(e)}))},editorState:this.state.editorState,ref:function(e){t.setDomEditorRef(e)},onChange:function(e){t.onProseChange(e)}})})]},"scrap-details-"+this.props.scrapId)}}]),n}(r.Component);function Dn(t){var e=j(ve),n=j(m),r=f();return Object(k.jsx)(In,{scrapId:t.match.params.id,scrapMap:e,onScrapCreate:function(t){return r(we(t.toJSON()))},onScrapUpdate:function(t){return r(Ce(t.toJSON()))},onScrapDelete:function(t){return r(ke(t))},headerOptions:n,onUpdateHeaderOptions:function(t){return r(y(t))}})}var En=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(){var t;Object(ft.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))).state={showListInput:!0,showCurrentScores:!1,nextCandidateLabel:"",nextCandidateDesc:"",candidates:[],winMatrix:[],candidateIndexA:-1,candidateIndexB:-1},t}return Object(jt.a)(n,[{key:"addCandidate",value:function(){for(var t=[].concat(Object(N.a)(this.state.candidates),[{label:this.state.nextCandidateLabel,description:this.state.nextCandidateDesc,currentScore:1,wins:0,losses:0}]),e=1/(10*t.length),n=Object(N.a)(Array(t.length)).map((function(n){return Array(t.length).fill(e)})),r=0;r<n.length;r++)n[r][r]=0;this.setState(Object(b.a)(Object(b.a)({},this.state),{},{candidates:t,winMatrix:n,nextCandidateLabel:"",nextCandidateDesc:""}))}},{key:"setupNewComparison",value:function(){var t=this,e=this.state.candidates.map((function(e,n){return 1/t.getTotalComparisons(n)})),n=this.randomSelectWeighted(e),r=e.map((function(e,r){return r===n?0:1/(t.state.winMatrix[r][n]+t.state.winMatrix[n][r])})),i=this.randomSelectWeighted(r);this.setState(Object(b.a)(Object(b.a)({},this.state),{},{showListInput:!1,candidateIndexA:n,candidateIndexB:i}))}},{key:"randomSelectWeighted",value:function(t){for(var e=t.reduce((function(t,e){return t+e})),n=Math.random()*e,r=0,i=0;i<t.length;i++)if((r+=t[i])>=n)return i;throw Error("should not get here")}},{key:"getTotalComparisons",value:function(t){for(var e=0,n=0;n<this.state.winMatrix.length;n++)e+=this.state.winMatrix[t][n]+this.state.winMatrix[n][t];return e}},{key:"renderComparison",value:function(){var t=this;if(this.state.candidateIndexA<0||this.state.candidateIndexB<0)return Object(k.jsx)("div",{children:"no comparison yet"});var e=this.state.candidates[this.state.candidateIndexA],n=this.state.candidates[this.state.candidateIndexB];return Object(k.jsxs)("div",{style:{marginTop:"100px",marginBottom:"100px"},children:[Object(k.jsx)("h2",{children:"Comparison"}),Object(k.jsxs)("div",{style:{display:"flex"},children:[Object(k.jsxs)("div",{style:{flex:1},children:[Object(k.jsxs)("h3",{children:[e.label,Object(k.jsx)("button",{onClick:function(){return t.updateWin(t.state.candidateIndexA,t.state.candidateIndexB)},children:"Select"})]}),e.description.split("\n").map((function(t){return Object(k.jsx)("p",{children:t})}))]}),Object(k.jsxs)("div",{style:{flex:1},children:[Object(k.jsxs)("h3",{children:[n.label,Object(k.jsx)("button",{onClick:function(){return t.updateWin(t.state.candidateIndexB,t.state.candidateIndexA)},children:"Select"})]}),n.description.split("\n").map((function(t){return Object(k.jsx)("p",{children:t})}))]})]})]})}},{key:"updateWin",value:function(t,e){var n=this,r=this.state.winMatrix;r[t][e]+=1;var i=this.state.candidates;i[t].wins+=1,i[e].losses+=1;for(var a=0;a<1e3;a++){for(var c=0;c<i.length;c++){for(var o=0,s=0;s<i.length;s++)o+=r[c][s];for(var l=0,u=0;u<i.length;u++){if(c!==u)l+=(r[c][u]+r[u][c])/(i[c].currentScore+i[u].currentScore)}i[c].currentScore=o/l}for(var d=0,p=0;p<i.length;p++)d+=i[p].currentScore;d/=i.length;for(var h=0;h<i.length;h++)i[h].currentScore/=d}this.setState(Object(b.a)(Object(b.a)({},this.state),{},{candidates:i,winMatrix:r}),(function(){n.setupNewComparison()}))}},{key:"renderWinMatrix",value:function(){return this.state.showCurrentScores?Object(k.jsxs)("div",{children:[Object(k.jsx)("h2",{children:"Current Win Matrix"}),Object(k.jsx)("pre",{children:this.state.winMatrix.map((function(t){return t.join(",\t")+"\n"}))})]}):Object(k.jsx)("div",{})}},{key:"renderCandidates",value:function(){if(!this.state.showCurrentScores&&!this.state.showListInput)return Object(k.jsx)("div",{});var t=this.state.candidates.map((function(t){return t})).sort((function(t,e){return e.currentScore-t.currentScore}));return Object(k.jsxs)("div",{children:[Object(k.jsxs)("h2",{children:[t.length," Candidates"]}),t.map((function(t,e){return Object(k.jsx)("div",{children:Object(k.jsxs)("h3",{children:[t.label," (",t.currentScore,", ",t.wins," wins, ",t.losses," losses)"]})})}))]})}},{key:"toggleShowCurrentScores",value:function(){this.setState(Object(b.a)(Object(b.a)({},this.state),{},{showCurrentScores:!this.state.showCurrentScores}))}},{key:"updateNextCandidateLabel",value:function(t){this.setState(Object(b.a)(Object(b.a)({},this.state),{},{nextCandidateLabel:t}))}},{key:"updateNextCandidateDesc",value:function(t){this.setState(Object(b.a)(Object(b.a)({},this.state),{},{nextCandidateDesc:t}))}},{key:"render",value:function(){var t,e=this;return t=this.state.showListInput?Object(k.jsxs)("div",{children:[Object(k.jsx)("h2",{children:"Declare Candidates"}),Object(k.jsx)("p",{children:"Let's create some candidates"}),Object(k.jsxs)("div",{children:[Object(k.jsx)("input",{type:"text",value:this.state.nextCandidateLabel,onChange:function(t){return e.updateNextCandidateLabel(t.target.value)}}),Object(k.jsx)("textarea",{value:this.state.nextCandidateDesc,onChange:function(t){return e.updateNextCandidateDesc(t.target.value)}})]}),Object(k.jsx)("button",{style:{display:"block"},onClick:function(){return e.addCandidate()},children:"Add Candidate"}),Object(k.jsx)("button",{style:{display:"block"},onClick:function(){return e.setupNewComparison()},children:"Parse and begin"}),this.renderCandidates()]}):Object(k.jsxs)("div",{children:[this.renderComparison(),Object(k.jsx)("button",{style:{display:"block"},onClick:function(){return e.toggleShowCurrentScores()},children:"Toggle results"}),this.renderWinMatrix(),this.renderCandidates()]}),Object(k.jsxs)("div",{style:{margin:"24px"},children:[Object(k.jsx)("h1",{children:"Decisions"}),Object(k.jsx)("p",{children:"Let's make some decisions based on pairwise comparisons. You know that FaceMash scene in Social Network? It's just like that, except hopefully you're using it for better decisions."}),t]})}}]),n}(r.Component),Tn=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).state=r.initializeState(t),r}return Object(jt.a)(n,[{key:"initializeState",value:function(t){return{scrapId:t.scrapId,editorState:this.buildInitialEditorState(t)}}},{key:"componentDidUpdate",value:function(t,e,n){this.state.scrapId!==this.props.scrapId&&this.setState(this.initializeState(this.props))}},{key:"buildInitialEditorState",value:function(t){return t.scrapMap[t.scrapId]?R.EditorState.createWithContent(R.ContentState.createFromBlockArray(this.props.parsedContentBlocks),hn):R.EditorState.createEmpty()}},{key:"normalizeProse",value:function(t){return t}},{key:"render",value:function(){return Object(k.jsx)("div",{style:pt,children:Object(k.jsx)(R.Editor,{readOnly:!0,onChange:function(){},editorState:this.state.editorState})})}}]),n}(r.Component);function Mn(t){var e=j(ve),n=f(),r=j(m);return Object(k.jsx)(Pn,{scrapId:t.match.params.id,scrapMap:e,onUpdateHeaderOptions:function(t){return n(y(Object(b.a)(Object(b.a)({},r),t)))},headerOptions:r})}var Pn=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).state={scrapId:t.scrapId,hasLoaded:!1,parsedContentBlocks:[]},r}return Object(jt.a)(n,[{key:"componentDidMount",value:function(){var t=ie(this.props.scrapId,[],this.props.scrapMap),e=function(t){var e={},n=0;return t.forEach((function(t){var r=t.getData(),i=r.get(st),a=r.get(Y)||0;n+=a,i&&(e[i]||(e[i]={character:i,totalDurationSec:0,percentDurationSec:0}),e[i].totalDurationSec+=a)})),Object.values(e).sort((function(t,e){return e.totalDurationSec-t.totalDurationSec})).map((function(t){return t.percentDurationSec=t.totalDurationSec/n,t}))}(t),n=function(t){var e={};return t.forEach((function(t){(t.getData().get($)||"").split("#").filter(Boolean).forEach((function(t){var n=t.trim();e[n]||(e[n]={trait:n,numberOfAppearances:0}),e[n].numberOfAppearances+=1}))})),Object.values(e).sort((function(t,e){return e.numberOfAppearances-t.numberOfAppearances}))}(t);this.setState({hasLoaded:!0,parsedContentBlocks:t}),this.props.onUpdateHeaderOptions(Object(b.a)(Object(b.a)({},this.props.headerOptions),{},{currentScrapId:this.state.scrapId,showReadLink:!1,showEditLink:!0,showPrintLink:!0,characterFilters:e,traitFilters:n}))}},{key:"render",value:function(){return this.state.hasLoaded?Object(k.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[Object(k.jsx)(he,{scrapId:this.state.scrapId,scrapMap:this.props.scrapMap,parsedContentBlocks:this.state.parsedContentBlocks,currentCharacterFilter:this.props.headerOptions.currentCharacterFilter||"",currentCompletionFilter:this.props.headerOptions.currentCompletionFilter||"",currentTraitFilter:this.props.headerOptions.currentTraitFilter||""}),Object(k.jsx)(Tn,{scrapId:this.state.scrapId,scrapMap:this.props.scrapMap,parsedContentBlocks:this.state.parsedContentBlocks})]}):Object(k.jsx)("div",{children:" ... loading ..."})}}]),n}(r.Component),Ln=n(29),An=n.p+"static/media/CourierPrime-Regular.68d89efc.ttf",Fn=n.p+"static/media/CourierPrime-Bold.ac693e5a.ttf",Wn=n.p+"static/media/CourierPrime-Italic.e56d9623.ttf",Hn=n.p+"static/media/CourierPrime-Bold-Italic.40cb412d.ttf";Ln.Font.register({family:"CourierPrime",format:"truetype",src:An}),Ln.Font.register({family:"CourierPrimeBold",format:"truetype",src:Fn}),Ln.Font.register({family:"CourierPrimeItalic",format:"truetype",src:Wn}),Ln.Font.register({family:"CourierPrimeBoldItalic",format:"truetype",src:Hn}),Ln.Font.registerHyphenationCallback((function(t){return[t]}));var Nn,Rn="12pt",Bn=Ln.StyleSheet.create({title:{marginLeft:"72pt",marginTop:"2in",textAlign:"center",textDecoration:"underline",width:"252pt"},author:{marginLeft:"72pt",paddingTop:"18pt",textAlign:"center",width:"252pt"},contactInfo:{position:"absolute",bottom:"1in",left:"1.5in"},dateInfo:{position:"absolute",right:"1in",bottom:"1in"},page:{fontFamily:"CourierPrime",fontSize:"12pt",paddingTop:"1in",paddingLeft:"1.5in",paddingRight:"1in",paddingBottom:"1in",margin:"0"},characterLine:{marginLeft:"144pt",width:"204pt"},dialogueLine:{marginLeft:"72pt",width:"252pt"},parentheticalLine:{marginLeft:"108pt",width:"174pt"},transitionLine:{paddingTop:Rn,textAlign:"right"},centeredLine:{textAlign:"center"},sceneHeaderLine:{fontFamily:"CourierPrimeBold",paddingBottom:Rn},block:{paddingBottom:Rn},bold:{fontFamily:"CourierPrimeBold"},italic:{fontFamily:"CourierPrimeItalic"},boldItalic:{fontFamily:"CourierPrimeBoldItalic"},underline:{textDecoration:"underline"},pageNumber:{position:"absolute",right:"1.25in",top:"0.5in",left:"1.5in",textAlign:"right"}});function zn(t){var e,n=[],r={elements:[]};return t.forEach((function(t){var i=t.getData(),a=t.getText();if(a.trim().length&&!i.get(Q)&&!i.get(X)){var c=void 0,o=Nn.ACTION;i.get(ot)?(c=Bn.characterLine,o=Nn.CHARACTER,a!==e&&(e=a)):i.get(lt)?(c=Bn.dialogueLine,o=Nn.DIALOGUE):i.get(ut)?(c=Bn.parentheticalLine,o=Nn.PARENTHETICAL):i.get(it)?(c=Bn.transitionLine,o=Nn.TRANSITION,e="",a.startsWith(">")&&(a=a.replace(/^>/,""))):i.get(rt)?(c=Bn.centeredLine,o=Nn.CENTERED,a.startsWith(">")&&a.endsWith("<")&&(a=a.replace(/^>/,"").replace(/<$/,""))):i.get(nt)&&(c=Bn.sceneHeaderLine,o=Nn.SCENE_HEADING,e="",a.startsWith(".")&&(a=a.replace(/^\./,"")));var s={text:a,style:c,type:o};(function(t,e){return e!==Nn.TRANSITION&&![Nn.DIALOGUE,Nn.PARENTHETICAL].includes(e)&&t!==Nn.SCENE_HEADING})(r.elements.length?r.elements[r.elements.length-1].type:null,s.type)&&(n.push(r),r={elements:[]}),r.elements.push(s)}})),r.elements.length&&n.push(r),n.filter((function(t){return!!t.elements.length}))}!function(t){t[t.SCENE_HEADING=0]="SCENE_HEADING",t[t.ACTION=1]="ACTION",t[t.DIALOGUE=2]="DIALOGUE",t[t.CHARACTER=3]="CHARACTER",t[t.PARENTHETICAL=4]="PARENTHETICAL",t[t.TRANSITION=5]="TRANSITION",t[t.CENTERED=6]="CENTERED"}(Nn||(Nn={}));var Un=/_(.*?)_/,Jn=/\*{3}(.*?)\*{3}/,_n=/\*{2}(.*?)\*{2}/,Gn=/\*(.*?)\*/;function Kn(t,e,n,r){var i=t.split(e);if(i.length>1){var a=[];return i.forEach((function(t,e){var i=e%2===0?n:Object(b.a)(Object(b.a)({},n),r);a.push.apply(a,Object(N.a)(Vn(t,i)))})),a}return[]}function Vn(t,e){var n=Kn(t,Un,e,Bn.underline);if(n.length)return n;var r=Kn(t,Jn,e,Bn.boldItalic);if(r.length)return r;var i=Kn(t,_n,e,Bn.bold);if(i.length)return i;var a=Kn(t,Gn,e,Bn.italic);return a.length?a:[{style:e,text:t}]}function Yn(t,e,n){if(!t)return null;var r,a=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return e&&(r=Object(k.jsxs)(i.a.Fragment,{children:[Object(k.jsx)(Ln.Text,{style:Bn.author,children:"by"}),Object(k.jsx)(Ln.Text,{style:Bn.author,children:e}),Object(k.jsx)(Ln.View,{style:Bn.contactInfo,children:n.split("\n").map((function(t){return Object(k.jsx)(Ln.Text,{children:t.trim()})}))}),Object(k.jsx)(Ln.View,{style:Bn.dateInfo,children:Object(k.jsx)(Ln.Text,{children:a})})]})),Object(k.jsxs)(Ln.Page,{size:"LETTER",style:Bn.page,children:[Object(k.jsx)(Ln.View,{style:Bn.title,children:t.split("|").map((function(t){return Object(k.jsx)(Ln.Text,{children:t.trim()})}))}),r]})}function Qn(t,e,n,r,i){var a=zn(e),c=!!n,o=Object(k.jsx)(Ln.Text,{style:Bn.pageNumber,render:function(t){var e=t.pageNumber,n=c?e-1:e;return 1===n?"":"".concat(n,".")},fixed:!0});return Object(k.jsxs)(Ln.Document,{title:t.synopsis.replace("|",""),author:r,creator:r,producer:"Revision (https://jon-simpkins.github.io/revision)",children:[Yn(n,r,i),Object(k.jsxs)(Ln.Page,{size:"LETTER",style:Bn.page,wrap:!0,children:[o,a.map((function(t){return Object(k.jsx)(Ln.View,{wrap:!1,style:Bn.block,children:t.elements.map((function(t){return Object(k.jsx)(Ln.Text,{style:t.style,children:Vn(t.text,{}).filter((function(t){return!!t.text.length})).map((function(t){return Object(k.jsx)(Ln.Text,{style:t.style,children:t.text})}))})}))})}))]})]})}function $n(t,e){var n=t.scrapMap[t.scrapId],r=t.headerOptions.includeTitlePage?n.synopsis:null;return Object(k.jsx)(Ln.PDFViewer,{style:{flex:1},children:Qn(n,e,r,t.author,t.contactInfo)})}function Xn(t){var e=j(ve),n=f(),r=j(m),i=j(_e);return Object(k.jsx)(qn,{scrapId:t.match.params.id,scrapMap:e,onUpdateHeaderOptions:function(t){return n(y(Object(b.a)(Object(b.a)({},r),t)))},headerOptions:r,author:i.author,contactInfo:i.contactInfo})}var qn=function(t){Object(bt.a)(n,t);var e=Object(gt.a)(n);function n(t){var r;return Object(ft.a)(this,n),(r=e.call(this,t)).state={scrapId:t.scrapId,hasLoaded:!1,alreadyWarned:!1,durationPages:0,parsedContentBlocks:[]},r}return Object(jt.a)(n,[{key:"componentDidMount",value:function(){var t=ie(this.props.scrapId,[],this.props.scrapMap),e=0;t.forEach((function(t){var n=t.getData().get(Y)||0;e+=n})),this.setState({hasLoaded:!0,parsedContentBlocks:t,alreadyWarned:e<=300,durationPages:Math.ceil(e/60)}),this.props.onUpdateHeaderOptions(Object(b.a)(Object(b.a)({},this.props.headerOptions),{},{currentScrapId:this.state.scrapId,showReadLink:!0,showEditLink:!0,showPrintLink:!1}))}},{key:"render",value:function(){var t=this;return this.state.hasLoaded?this.state.alreadyWarned?Object(k.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:$n(this.props,this.state.parsedContentBlocks)}):Object(k.jsxs)("div",{style:{margin:"24px"},children:[Object(k.jsxs)("p",{children:["Long PDFs can take a bit to render (this one will be about ",this.state.durationPages," pages)."]}),Object(k.jsx)("p",{children:"Click the following button to render, and then please be patient :) "}),Object(k.jsx)(d.a,{primary:!0,icon:!0,title:"Render PDF",onClick:function(){t.setState({alreadyWarned:!0})},children:Object(k.jsx)(u.a,{name:"file pdf outline"})})]}):Object(k.jsx)("div",{children:" ... loading ..."})}}]),n}(r.Component);var Zn=function(){return Object(k.jsx)("div",{style:{padding:0,margin:0,height:"100vh"},children:Object(k.jsxs)(o.a,{children:[Object(k.jsx)(De,{}),Object(k.jsx)("div",{style:{height:"calc(100% - 68px)"},children:Object(k.jsxs)(wt.c,{children:[Object(k.jsx)(wt.a,{path:"/decisions",component:En}),Object(k.jsx)(wt.a,{path:"/data",component:cn}),Object(k.jsx)(wt.a,{path:"/scrap/:id",component:Dn}),Object(k.jsx)(wt.a,{path:"/read/:id",component:Mn}),Object(k.jsx)(wt.a,{path:"/print/:id",component:Xn}),Object(k.jsx)(wt.a,{path:"/",component:$e})]})})]})})},tr=Object(g.a)({reducer:{scrapList:Ie,headerOptions:S,workspaceContactInfo:Ye},middleware:function(t){return t().concat([ye,Ue])}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(810);c.a.render(Object(k.jsx)(i.a.StrictMode,{children:Object(k.jsx)(h.a,{store:tr,children:Object(k.jsx)(Zn,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[811,1,2]]]);
//# sourceMappingURL=main.99459deb.chunk.js.map