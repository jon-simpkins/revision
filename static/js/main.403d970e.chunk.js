(this.webpackJsonprevision=this.webpackJsonprevision||[]).push([[0],{19:function(t,e,r){var n,i,a;i=[r(270)],void 0===(a="function"===typeof(n=function(t){"use strict";var e=t.Reader,r=t.Writer,n=t.util,i=t.roots.default||(t.roots.default={});return i.Timestamp=function(){function a(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return a.prototype.seconds=0,a.prototype.nanos=0,a.create=function(t){return new a(t)},a.encode=function(t,e){return e||(e=r.create()),null!=t.seconds&&Object.hasOwnProperty.call(t,"seconds")&&e.uint32(8).int32(t.seconds),null!=t.nanos&&Object.hasOwnProperty.call(t,"nanos")&&e.uint32(16).int32(t.nanos),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,r){t instanceof e||(t=e.create(t));for(var n=void 0===r?t.len:t.pos+r,a=new i.Timestamp;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:a.seconds=t.int32();break;case 2:a.nanos=t.int32();break;default:t.skipType(7&o)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.seconds&&t.hasOwnProperty("seconds")&&!n.isInteger(t.seconds)?"seconds: integer expected":null!=t.nanos&&t.hasOwnProperty("nanos")&&!n.isInteger(t.nanos)?"nanos: integer expected":null},a.fromObject=function(t){if(t instanceof i.Timestamp)return t;var e=new i.Timestamp;return null!=t.seconds&&(e.seconds=0|t.seconds),null!=t.nanos&&(e.nanos=0|t.nanos),e},a.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.seconds=0,r.nanos=0),null!=t.seconds&&t.hasOwnProperty("seconds")&&(r.seconds=t.seconds),null!=t.nanos&&t.hasOwnProperty("nanos")&&(r.nanos=t.nanos),r},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Duration=function(){function a(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return a.prototype.seconds=0,a.prototype.nanos=0,a.create=function(t){return new a(t)},a.encode=function(t,e){return e||(e=r.create()),null!=t.seconds&&Object.hasOwnProperty.call(t,"seconds")&&e.uint32(8).int32(t.seconds),null!=t.nanos&&Object.hasOwnProperty.call(t,"nanos")&&e.uint32(16).int32(t.nanos),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,r){t instanceof e||(t=e.create(t));for(var n=void 0===r?t.len:t.pos+r,a=new i.Duration;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:a.seconds=t.int32();break;case 2:a.nanos=t.int32();break;default:t.skipType(7&o)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.seconds&&t.hasOwnProperty("seconds")&&!n.isInteger(t.seconds)?"seconds: integer expected":null!=t.nanos&&t.hasOwnProperty("nanos")&&!n.isInteger(t.nanos)?"nanos: integer expected":null},a.fromObject=function(t){if(t instanceof i.Duration)return t;var e=new i.Duration;return null!=t.seconds&&(e.seconds=0|t.seconds),null!=t.nanos&&(e.nanos=0|t.nanos),e},a.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.seconds=0,r.nanos=0),null!=t.seconds&&t.hasOwnProperty("seconds")&&(r.seconds=t.seconds),null!=t.nanos&&t.hasOwnProperty("nanos")&&(r.nanos=t.nanos),r},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Story=function(){function a(t){if(this.relatedStoryIds=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return a.prototype.id="",a.prototype.name="",a.prototype.description="",a.prototype.duration=null,a.prototype.relatedStoryIds=n.emptyArray,a.create=function(t){return new a(t)},a.encode=function(t,e){if(e||(e=r.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(10).string(t.id),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(18).string(t.name),null!=t.duration&&Object.hasOwnProperty.call(t,"duration")&&i.Duration.encode(t.duration,e.uint32(26).fork()).ldelim(),null!=t.relatedStoryIds&&t.relatedStoryIds.length)for(var n=0;n<t.relatedStoryIds.length;++n)e.uint32(34).string(t.relatedStoryIds[n]);return null!=t.description&&Object.hasOwnProperty.call(t,"description")&&e.uint32(42).string(t.description),e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,r){t instanceof e||(t=e.create(t));for(var n=void 0===r?t.len:t.pos+r,a=new i.Story;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:a.id=t.string();break;case 2:a.name=t.string();break;case 5:a.description=t.string();break;case 3:a.duration=i.Duration.decode(t,t.uint32());break;case 4:a.relatedStoryIds&&a.relatedStoryIds.length||(a.relatedStoryIds=[]),a.relatedStoryIds.push(t.string());break;default:t.skipType(7&o)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!n.isString(t.id))return"id: string expected";if(null!=t.name&&t.hasOwnProperty("name")&&!n.isString(t.name))return"name: string expected";if(null!=t.description&&t.hasOwnProperty("description")&&!n.isString(t.description))return"description: string expected";if(null!=t.duration&&t.hasOwnProperty("duration")){var e=i.Duration.verify(t.duration);if(e)return"duration."+e}if(null!=t.relatedStoryIds&&t.hasOwnProperty("relatedStoryIds")){if(!Array.isArray(t.relatedStoryIds))return"relatedStoryIds: array expected";for(var r=0;r<t.relatedStoryIds.length;++r)if(!n.isString(t.relatedStoryIds[r]))return"relatedStoryIds: string[] expected"}return null},a.fromObject=function(t){if(t instanceof i.Story)return t;var e=new i.Story;if(null!=t.id&&(e.id=String(t.id)),null!=t.name&&(e.name=String(t.name)),null!=t.description&&(e.description=String(t.description)),null!=t.duration){if("object"!==typeof t.duration)throw TypeError(".Story.duration: object expected");e.duration=i.Duration.fromObject(t.duration)}if(t.relatedStoryIds){if(!Array.isArray(t.relatedStoryIds))throw TypeError(".Story.relatedStoryIds: array expected");e.relatedStoryIds=[];for(var r=0;r<t.relatedStoryIds.length;++r)e.relatedStoryIds[r]=String(t.relatedStoryIds[r])}return e},a.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.relatedStoryIds=[]),e.defaults&&(r.id="",r.name="",r.duration=null,r.description=""),null!=t.id&&t.hasOwnProperty("id")&&(r.id=t.id),null!=t.name&&t.hasOwnProperty("name")&&(r.name=t.name),null!=t.duration&&t.hasOwnProperty("duration")&&(r.duration=i.Duration.toObject(t.duration,e)),t.relatedStoryIds&&t.relatedStoryIds.length){r.relatedStoryIds=[];for(var n=0;n<t.relatedStoryIds.length;++n)r.relatedStoryIds[n]=t.relatedStoryIds[n]}return null!=t.description&&t.hasOwnProperty("description")&&(r.description=t.description),r},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Scrap=function(){function a(t){if(this.stories=[],this.childScraps=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return a.prototype.id="",a.prototype.intendedDurationSec=0,a.prototype.synopsis="",a.prototype.prose="",a.prototype.stories=n.emptyArray,a.prototype.childScraps=n.emptyArray,a.create=function(t){return new a(t)},a.encode=function(t,e){if(e||(e=r.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(10).string(t.id),null!=t.intendedDurationSec&&Object.hasOwnProperty.call(t,"intendedDurationSec")&&e.uint32(16).uint32(t.intendedDurationSec),null!=t.synopsis&&Object.hasOwnProperty.call(t,"synopsis")&&e.uint32(26).string(t.synopsis),null!=t.prose&&Object.hasOwnProperty.call(t,"prose")&&e.uint32(34).string(t.prose),null!=t.stories&&t.stories.length)for(var n=0;n<t.stories.length;++n)e.uint32(66).string(t.stories[n]);if(null!=t.childScraps&&t.childScraps.length)for(n=0;n<t.childScraps.length;++n)e.uint32(74).string(t.childScraps[n]);return e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,r){t instanceof e||(t=e.create(t));for(var n=void 0===r?t.len:t.pos+r,a=new i.Scrap;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:a.id=t.string();break;case 2:a.intendedDurationSec=t.uint32();break;case 3:a.synopsis=t.string();break;case 4:a.prose=t.string();break;case 8:a.stories&&a.stories.length||(a.stories=[]),a.stories.push(t.string());break;case 9:a.childScraps&&a.childScraps.length||(a.childScraps=[]),a.childScraps.push(t.string());break;default:t.skipType(7&o)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!n.isString(t.id))return"id: string expected";if(null!=t.intendedDurationSec&&t.hasOwnProperty("intendedDurationSec")&&!n.isInteger(t.intendedDurationSec))return"intendedDurationSec: integer expected";if(null!=t.synopsis&&t.hasOwnProperty("synopsis")&&!n.isString(t.synopsis))return"synopsis: string expected";if(null!=t.prose&&t.hasOwnProperty("prose")&&!n.isString(t.prose))return"prose: string expected";if(null!=t.stories&&t.hasOwnProperty("stories")){if(!Array.isArray(t.stories))return"stories: array expected";for(var e=0;e<t.stories.length;++e)if(!n.isString(t.stories[e]))return"stories: string[] expected"}if(null!=t.childScraps&&t.hasOwnProperty("childScraps")){if(!Array.isArray(t.childScraps))return"childScraps: array expected";for(e=0;e<t.childScraps.length;++e)if(!n.isString(t.childScraps[e]))return"childScraps: string[] expected"}return null},a.fromObject=function(t){if(t instanceof i.Scrap)return t;var e=new i.Scrap;if(null!=t.id&&(e.id=String(t.id)),null!=t.intendedDurationSec&&(e.intendedDurationSec=t.intendedDurationSec>>>0),null!=t.synopsis&&(e.synopsis=String(t.synopsis)),null!=t.prose&&(e.prose=String(t.prose)),t.stories){if(!Array.isArray(t.stories))throw TypeError(".Scrap.stories: array expected");e.stories=[];for(var r=0;r<t.stories.length;++r)e.stories[r]=String(t.stories[r])}if(t.childScraps){if(!Array.isArray(t.childScraps))throw TypeError(".Scrap.childScraps: array expected");for(e.childScraps=[],r=0;r<t.childScraps.length;++r)e.childScraps[r]=String(t.childScraps[r])}return e},a.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.stories=[],r.childScraps=[]),e.defaults&&(r.id="",r.intendedDurationSec=0,r.synopsis="",r.prose=""),null!=t.id&&t.hasOwnProperty("id")&&(r.id=t.id),null!=t.intendedDurationSec&&t.hasOwnProperty("intendedDurationSec")&&(r.intendedDurationSec=t.intendedDurationSec),null!=t.synopsis&&t.hasOwnProperty("synopsis")&&(r.synopsis=t.synopsis),null!=t.prose&&t.hasOwnProperty("prose")&&(r.prose=t.prose),t.stories&&t.stories.length){r.stories=[];for(var n=0;n<t.stories.length;++n)r.stories[n]=t.stories[n]}if(t.childScraps&&t.childScraps.length)for(r.childScraps=[],n=0;n<t.childScraps.length;++n)r.childScraps[n]=t.childScraps[n];return r},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.WritingWorkspace=function(){function a(t){if(this.stories=[],this.scraps=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return a.prototype.stories=n.emptyArray,a.prototype.scraps=n.emptyArray,a.create=function(t){return new a(t)},a.encode=function(t,e){if(e||(e=r.create()),null!=t.stories&&t.stories.length)for(var n=0;n<t.stories.length;++n)i.Story.encode(t.stories[n],e.uint32(10).fork()).ldelim();if(null!=t.scraps&&t.scraps.length)for(n=0;n<t.scraps.length;++n)i.Scrap.encode(t.scraps[n],e.uint32(18).fork()).ldelim();return e},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,r){t instanceof e||(t=e.create(t));for(var n=void 0===r?t.len:t.pos+r,a=new i.WritingWorkspace;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:a.stories&&a.stories.length||(a.stories=[]),a.stories.push(i.Story.decode(t,t.uint32()));break;case 2:a.scraps&&a.scraps.length||(a.scraps=[]),a.scraps.push(i.Scrap.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return a},a.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},a.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.stories&&t.hasOwnProperty("stories")){if(!Array.isArray(t.stories))return"stories: array expected";for(var e=0;e<t.stories.length;++e)if(r=i.Story.verify(t.stories[e]))return"stories."+r}if(null!=t.scraps&&t.hasOwnProperty("scraps")){if(!Array.isArray(t.scraps))return"scraps: array expected";for(e=0;e<t.scraps.length;++e){var r;if(r=i.Scrap.verify(t.scraps[e]))return"scraps."+r}}return null},a.fromObject=function(t){if(t instanceof i.WritingWorkspace)return t;var e=new i.WritingWorkspace;if(t.stories){if(!Array.isArray(t.stories))throw TypeError(".WritingWorkspace.stories: array expected");e.stories=[];for(var r=0;r<t.stories.length;++r){if("object"!==typeof t.stories[r])throw TypeError(".WritingWorkspace.stories: object expected");e.stories[r]=i.Story.fromObject(t.stories[r])}}if(t.scraps){if(!Array.isArray(t.scraps))throw TypeError(".WritingWorkspace.scraps: array expected");for(e.scraps=[],r=0;r<t.scraps.length;++r){if("object"!==typeof t.scraps[r])throw TypeError(".WritingWorkspace.scraps: object expected");e.scraps[r]=i.Scrap.fromObject(t.scraps[r])}}return e},a.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.stories=[],r.scraps=[]),t.stories&&t.stories.length){r.stories=[];for(var n=0;n<t.stories.length;++n)r.stories[n]=i.Story.toObject(t.stories[n],e)}if(t.scraps&&t.scraps.length)for(r.scraps=[],n=0;n<t.scraps.length;++n)r.scraps[n]=i.Scrap.toObject(t.scraps[n],e);return r},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i})?n.apply(e,i):n)||(t.exports=a)},260:function(t,e,r){},261:function(t,e,r){},384:function(t,e,r){"use strict";r.r(e);var n=r(0),i=r.n(n),a=r(53),o=r.n(a),s=(r(260),r(261),r(13)),c=r(23),l=r(403),d=r(404),u=r(88),p=r(118),h=function(){return Object(p.b)()},f=p.c,j=r(71),b=Object(j.b)({name:"headerOptions",initialState:{options:{currentScrapId:"",showEditLink:!1,showReadLink:!1,characterFilters:[],currentCharacterFilter:"",currentCompletionFilter:"",traitFilters:[],currentTraitFilter:""}},reducers:{updateHeaderOptions:function(t,e){t.options=e.payload}}}),y=function(t){return t.headerOptions.options},g=b.actions.updateHeaderOptions,O=b.reducer,v=r(1);function S(){var t,e=h(),r=f(y);if(r.characterFilters.length){var n=r.characterFilters.map((function(t){return{key:t.character,text:"".concat(t.character," (").concat(Math.round(1e3*t.percentDurationSec)/10,"%)"),value:t.character}}));n.unshift({key:"none",value:"No Character Filter",text:"No Character Filter"}),t=Object(v.jsx)(l.a,{text:r.currentCharacterFilter||"Filter by character",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:r.currentCharacterFilter,options:n,onChange:function(t,n){e(g(Object(s.a)(Object(s.a)({},r),{},{currentCharacterFilter:n.value,currentCompletionFilter:"",currentTraitFilter:""})))}})}var i,a,o,p=Object(v.jsx)(l.a,{text:r.currentCompletionFilter||"Filter by completion",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:r.currentCompletionFilter,options:[{key:"none",value:"",text:"No Completion Filter"},{key:"pending",value:"Pending Completion",text:"Pending Completion"}],onChange:function(t,n){e(g(Object(s.a)(Object(s.a)({},r),{},{currentCharacterFilter:"",currentTraitFilter:"",currentCompletionFilter:n.value})))}});if(r.traitFilters.length){var j=r.traitFilters.map((function(t){return{key:t.trait,text:"".concat(t.trait," (").concat(t.numberOfAppearances,")"),value:t.trait}}));j.unshift({key:"none",value:"No Trait Filter",text:"No Trait Filter"}),i=Object(v.jsx)(l.a,{text:r.currentTraitFilter||"Filter by trait",floating:!0,labeled:!0,scrolling:!0,item:!0,className:"icon",value:r.currentTraitFilter,options:j,onChange:function(t,n){e(g(Object(s.a)(Object(s.a)({},r),{},{currentCharacterFilter:"",currentTraitFilter:n.value,currentCompletionFilter:""})))}})}return r.showEditLink&&(a=Object(v.jsx)(c.b,{to:"/scrap/"+r.currentScrapId,children:Object(v.jsx)(d.a.Item,{children:Object(v.jsx)(u.a,{name:"edit"})})})),r.showReadLink&&(o=Object(v.jsx)(c.b,{to:"/read/"+r.currentScrapId,children:Object(v.jsx)(d.a.Item,{children:Object(v.jsx)(u.a,{name:"film"})})})),Object(v.jsxs)(d.a,{children:[Object(v.jsx)(c.b,{to:"/",children:Object(v.jsx)(d.a.Item,{header:!0,children:"Revision"})}),Object(v.jsx)(c.b,{to:"/data",children:Object(v.jsx)(d.a.Item,{children:Object(v.jsx)(u.a,{name:"save"})})}),Object(v.jsxs)(d.a.Menu,{position:"right",children:[p,i,t,a,o]})]})}var x=r(21),m=r(14),k=r(12),C=r(15),w=r(16),D=r(406),I=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"getCardUrl",value:function(){return"/story/"+this.props.story.id}},{key:"render",value:function(){return Object(v.jsx)(c.b,{to:this.getCardUrl(),children:Object(v.jsxs)(D.a,{style:{margin:"8px"},children:[Object(v.jsx)(D.a.Content,{header:this.props.story.name}),Object(v.jsx)(D.a.Content,{children:this.props.story.description.split("\n").map((function(t,e){return Object(v.jsx)("p",{children:t},e)}))})]})})}}]),r}(n.Component),M=r(409),E=r(410),F=r(408),T=r(156),P=r(19),W="story-ids";function A(t){return"story-".concat(t)}function L(){return N().map((function(t){return function(t){var e=localStorage.getItem(A(t));if(!e)throw Error("Unable to read story ".concat(t," from local storage"));return P.Story.create(JSON.parse(e))}(t)}))}function N(){var t=localStorage.getItem(W)||"[]";return JSON.parse(t)}function B(t){localStorage.setItem(W,JSON.stringify(t))}function z(t){localStorage.setItem(A(t.id),JSON.stringify(t))}function J(t){z(t);var e=N();e.push(t.id),B(e)}var U=function(){var t={storyMap:{}};return L().forEach((function(e){t.storyMap[e.id]=e.toJSON()})),t}(),H="storyList",R=Object(j.b)({name:H,initialState:U,reducers:{createStory:function(t,e){t.storyMap[e.payload.id]=e.payload},updateStory:function(t,e){t.storyMap[e.payload.id]=e.payload},removeStory:function(t,e){delete t.storyMap[e.payload]}}}),K=function(t){return function(t){return function(e){var r=t(e);return e.type.startsWith("storyList/")&&V(e),r}}},V=function(t){switch(t.type){case"".concat(H,"/createStory"):J(t.payload);break;case"".concat(H,"/updateStory"):z(t.payload);break;case"".concat(H,"/removeStory"):e=t.payload,B(N().filter((function(t){return t!==e}))),localStorage.removeItem(A(e))}var e},G=function(t){for(var e={},r=0,n=Object.entries(t.storyList.storyMap);r<n.length;r++){var i=Object(T.a)(n[r],2),a=i[0],o=i[1];e[a]=P.Story.fromObject(o)}return e},Y=R.actions,$=Y.createStory,_=Y.updateStory,q=Y.removeStory,X=R.reducer,Q=r(407),Z="scrap-ids";function tt(t){return"scrap-".concat(t)}function et(){return rt().map((function(t){return function(t){var e=localStorage.getItem(tt(t));if(!e)throw Error("Unable to read scrap ".concat(t," from local storage"));return P.Scrap.create(JSON.parse(e))}(t)}))}function rt(){var t=localStorage.getItem(Z)||"[]";return JSON.parse(t)}function nt(t){localStorage.setItem(Z,JSON.stringify(t))}function it(t){localStorage.setItem(tt(t.id),JSON.stringify(t))}function at(t){it(t);var e=rt();e.push(t.id),nt(e)}var ot=function(){var t={scrapMap:{}};return et().forEach((function(e){t.scrapMap[e.id]=e.toJSON()})),t}(),st="scrapList",ct=Object(j.b)({name:st,initialState:ot,reducers:{createScrap:function(t,e){t.scrapMap[e.payload.id]=e.payload},updateScrap:function(t,e){t.scrapMap[e.payload.id]=e.payload},removeScrap:function(t,e){delete t.scrapMap[e.payload]}}}),lt=function(t){return function(t){return function(e){var r=t(e);return e.type.startsWith("scrapList/")&&dt(e),r}}},dt=function(t){switch(t.type){case"".concat(st,"/createScrap"):at(t.payload);break;case"".concat(st,"/updateScrap"):it(t.payload);break;case"".concat(st,"/removeScrap"):e=t.payload,nt(rt().filter((function(t){return t!==e}))),localStorage.removeItem(tt(e))}var e},ut=function(t){for(var e={},r=0,n=Object.entries(t.scrapList.scrapMap);r<n.length;r++){var i=Object(T.a)(n[r],2),a=i[0],o=i[1];e[a]=P.Scrap.fromObject(o)}return e},pt=ct.actions,ht=pt.createScrap,ft=pt.updateScrap,jt=(pt.removeScrap,ct.reducer);function bt(t){var e=Object.values(t);return e.length?Object(v.jsx)(M.a,{style:{display:"flex",flexWrap:"wrap"},children:e.map((function(t,e){return Object(v.jsx)(I,{story:t},e)}))}):Object(v.jsx)(M.a,{children:"Whoops, no stories yet"})}function yt(){var t=f(G),e=h(),r=Object(x.f)();return Object(v.jsx)("div",{style:{margin:"24px"},children:Object(v.jsxs)(M.a.Group,{children:[Object(v.jsxs)(M.a,{style:{display:"flex"},children:[Object(v.jsxs)(E.a,{size:"medium",children:["Story List",Object(v.jsx)(E.a.Subheader,{children:"All your stories"})]}),Object(v.jsx)("div",{style:{flex:1,textAlign:"right"},children:Object(v.jsx)(F.a,{icon:!0,color:"green",onClick:function(){var t=P.Story.create({id:Object(Q.a)(),name:"New Story",description:"A story about something"}).toJSON();e($(t));var n,i=(n=t.id,P.Scrap.create({id:Object(Q.a)(),synopsis:"Story Content",prose:"Here is where you can summarize the story, and start to structure / brainstorm\nFeel free to create new scraps for alternative starting points, or new supporting docs for this story.",stories:[n]}).toJSON());e(ht(i)),r.push("/story/".concat(t.id))},children:Object(v.jsx)(u.a,{name:"add"})})})]}),bt(t)]})})}var gt=r(399),Ot=r(405),vt=r(400);function St(t){var e="",r=Math.floor(t/3600);t-=3600*r,e+=r.toString().padStart(2,"0")+":";var n=Math.floor(t/60);return t-=60*n,e+=n.toString().padStart(2,"0")+":",e+=Math.round(t).toString().padStart(2,"0")}function xt(t){if(!new RegExp("^[0-9:]+$").test(t))throw Error("Invalid duration string");var e=t.split(":").filter(Boolean);if(e.length>3)throw Error("Invalid duration string");for(var r=0,n=0;n<e.length;n++)r=60*r+parseInt(e[n],10);return r}var mt=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){var t;Object(m.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))).state={durationErrorString:null,currentScrapFilter:"mine",currentScrapId:""},t}return Object(k.a)(r,[{key:"onNameChange",value:function(t){var e=this.props.story;e.name=t,this.props.onStoryChange(e)}},{key:"onDescriptionChange",value:function(t){var e=this.props.story;e.description=t,this.props.onStoryChange(e)}},{key:"getDurationString",value:function(){var t,e;return St((null===(t=this.props.story)||void 0===t||null===(e=t.duration)||void 0===e?void 0:e.seconds)||0)}},{key:"onDurationChange",value:function(t){var e;try{e=xt(t)}catch(n){return this.setDurationErrorString(!0)}var r=this.props.story;r.duration=P.Duration.create({seconds:e}),this.props.onStoryChange(r),this.setDurationErrorString(!1)}},{key:"setDurationErrorString",value:function(t){this.setState((function(e){return Object(s.a)(Object(s.a)({},e),{},{durationErrorString:t?"Please enter a duration of format HH:MM:SS":null})}))}},{key:"getFilteredScraps",value:function(t){var e=this;return this.props.scraps.filter((function(r){var n,i;return!("mine"===t&&r.stories.indexOf((null===(n=e.props.story)||void 0===n?void 0:n.id)||"")<0)&&!("others"===t&&r.stories.indexOf((null===(i=e.props.story)||void 0===i?void 0:i.id)||"")>=0)}))}},{key:"createNewScrap",value:function(){var t,e;return P.Scrap.create({id:Object(Q.a)(),synopsis:"New Scrap",prose:'New scrap for "'+(null===(t=this.props.story)||void 0===t?void 0:t.name)+'" story\nFill this out with notes or prose content',stories:[null===(e=this.props.story)||void 0===e?void 0:e.id]})}},{key:"renderScrapDetails",value:function(){var t,e,r=this,n=this.props.scraps.find((function(t){return t.id===r.state.currentScrapId}));return n?(e=n.stories.indexOf((null===(t=this.props.story)||void 0===t?void 0:t.id)||"")>=0?Object(v.jsx)(F.a,{icon:!0,color:"red",onClick:function(){var t=n;t.stories=t.stories.filter((function(t){var e;return t!==(null===(e=r.props.story)||void 0===e?void 0:e.id)})),r.props.onScrapUpdate(t)},children:Object(v.jsx)(u.a,{name:"unlink"})}):Object(v.jsx)(F.a,{icon:!0,color:"green",onClick:function(){var t,e=n;e.stories.push((null===(t=r.props.story)||void 0===t?void 0:t.id)||""),r.props.onScrapUpdate(e)},children:Object(v.jsx)(u.a,{name:"linkify"})}),Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsx)(E.a,{children:n.synopsis}),Object(v.jsx)("div",{style:{flex:1,textAlign:"right"},children:e})]}),Object(v.jsx)(gt.a,{text:!0,children:n.prose.split("\n").map((function(t,e){return Object(v.jsx)("p",{children:t},"line-"+e)}))}),Object(v.jsx)("div",{style:{marginTop:"32px"},children:Object(v.jsx)(c.b,{to:"/scrap/".concat(n.id),children:Object(v.jsx)(F.a,{primary:!0,children:"Start writing"})})})]})):Object(v.jsx)(E.a,{children:"Please select a scrap"})}},{key:"render",value:function(){var t=this;return this.props.story?Object(v.jsxs)("div",{style:{margin:"24px"},children:[Object(v.jsxs)(M.a.Group,{children:[Object(v.jsxs)(M.a,{style:{display:"flex"},children:[Object(v.jsxs)(E.a,{children:["Story Details",Object(v.jsx)(E.a.Subheader,{children:"Set the title, top-level description here"})]}),Object(v.jsx)("div",{style:{flex:1,textAlign:"right"},children:Object(v.jsx)(F.a,{icon:!0,color:"red",onClick:function(){return t.props.onStoryDelete()},children:Object(v.jsx)(u.a,{name:"delete"})})})]}),Object(v.jsx)(M.a,{children:Object(v.jsxs)(Ot.a,{children:[Object(v.jsxs)(Ot.a.Group,{widths:"equal",children:[Object(v.jsx)(Ot.a.Input,{label:"Story Name",defaultValue:this.props.story.name,onChange:function(e){return t.onNameChange(e.target.value)}}),Object(v.jsx)(Ot.a.Input,{label:"Intended Duration (HH:MM:SS)",defaultValue:this.getDurationString(),error:this.state.durationErrorString,onChange:function(e){return t.onDurationChange(e.target.value)}})]}),Object(v.jsxs)(Ot.a.Field,{children:[Object(v.jsx)("label",{children:"Story Description"}),Object(v.jsx)(vt.a,{defaultValue:this.props.story.description,onChange:function(e){return t.onDescriptionChange(e.target.value)},style:{fontFamily:"CourierPrime",height:"125px"}})]})]})})]}),Object(v.jsxs)(M.a.Group,{children:[Object(v.jsxs)(M.a,{style:{display:"flex"},children:[Object(v.jsxs)(E.a,{children:["Scraps",Object(v.jsx)(E.a.Subheader,{children:"These are the bits and pieces that make up the story"})]}),Object(v.jsx)("div",{style:{flex:1,textAlign:"right"},children:Object(v.jsx)(F.a,{icon:!0,color:"green",onClick:function(){t.props.onScrapCreate(t.createNewScrap())},children:Object(v.jsx)(u.a,{name:"add"})})})]}),Object(v.jsxs)(M.a,{style:{display:"flex"},children:[Object(v.jsxs)(d.a,{pointing:!0,vertical:!0,children:[Object(v.jsx)(d.a.Item,{children:Object(v.jsx)(l.a,{fluid:!0,selection:!0,onChange:function(e,r){var n=r.value;t.setState(Object(s.a)(Object(s.a)({},t.state),{},{currentScrapFilter:n}))},defaultValue:this.state.currentScrapFilter,options:[{value:"all",text:"All stories",description:""+this.getFilteredScraps("all").length},{value:"mine",text:"This story",description:""+this.getFilteredScraps("mine").length},{value:"others",text:"Other stories",description:""+this.getFilteredScraps("others").length}]})}),this.getFilteredScraps(this.state.currentScrapFilter).map((function(e,r){return Object(v.jsx)(d.a.Item,{name:e.id,active:e.id===t.state.currentScrapId,onClick:function(){return t.setState(Object(s.a)(Object(s.a)({},t.state),{},{currentScrapId:e.id}))},children:e.synopsis},"scrap-menu-"+r)})).filter(Boolean)]}),Object(v.jsx)("div",{style:{flex:1,marginLeft:"32px"},children:this.renderScrapDetails()})]})]})]}):Object(v.jsx)("div",{children:"Whoops, could not find story"})}}]),r}(n.Component);function kt(t){var e,r,n=f((r=null===(e=t.match.params)||void 0===e?void 0:e.id,function(t){var e=t.storyList.storyMap[r];return e?P.Story.create(e):null})),i=Object.values(f(ut)),a=h(),o=Object(x.f)();return Object(v.jsx)(mt,{story:n,scraps:i,onStoryChange:function(t){return a(_(t.toJSON()))},onStoryDelete:function(){a(q(n.id)),o.push("/")},onScrapCreate:function(t){a(ht(t.toJSON())),o.push("/scrap/"+t.id)},onScrapUpdate:function(t){a(ft(t.toJSON()))}})}var Ct=r(235),wt=r(181),Dt=r.n(wt),It=r(236),Mt=r.n(It);function Et(){var t="writing_workspace_"+Date.now()+".write";Mt()(function(){var t=P.WritingWorkspace.create({stories:L(),scraps:et()});return P.WritingWorkspace.encode(t).finish()}(),t)}function Ft(){return(Ft=Object(Ct.a)(Dt.a.mark((function t(e){var r;return Dt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e[0].arrayBuffer();case 4:r=t.sent,Tt(new Uint8Array(r)),window.location.reload();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tt(t){var e=P.WritingWorkspace.decode(t);localStorage.clear(),e.stories.forEach((function(t){J(t)})),e.scraps.forEach((function(t){at(t)}))}function Pt(){var t=f(G);return Object(v.jsx)("div",{style:{margin:"24px"},children:Object(v.jsxs)(M.a.Group,{children:[Object(v.jsx)(M.a,{style:{display:"flex"},children:Object(v.jsxs)(E.a,{size:"medium",children:["Data Management",Object(v.jsx)(E.a.Subheader,{children:"Load, Save, or Clear your Workspace"})]})}),Object(v.jsxs)(M.a,{children:[Object.keys(t).length," Stories"]}),Object(v.jsxs)(M.a,{children:[Object(v.jsx)(F.a,{color:"green",onClick:function(){Et()},children:"Download Workspace"}),Object(v.jsx)(F.a,{color:"red",onClick:function(){localStorage.clear(),window.location.reload()},children:"Clear Workspace"})]}),Object(v.jsxs)(M.a,{children:[Object(v.jsx)(E.a,{size:"small",children:"Upload Workspace"}),Object(v.jsx)("input",{type:"file",accept:".write",onChange:function(t){return function(t){return Ft.apply(this,arguments)}(t.target.files)}})]})]})})}var Wt=r(48),At=r(237),Lt=r(20),Nt=r(131),Bt=r.n(Nt),zt=(r(382),r(182)),Jt=r(401),Ut=r(183),Ht=r(238),Rt=r.n(Ht),Kt=r(9),Vt=1.0909,Gt="37em",Yt="scrapId",$t="ancestorField",_t="pendingDurationSecContribution",qt="durationSecContribution",Xt="isScrapTrait",Qt="scrapTraitText",Zt="isScrapPlaceholder",te="scrapPlaceholderText",ee="scrapPlaceholderDurationSecField",re="isScrapEmbedding",ne="scrapLink",ie="isFountainHeader",ae="isFountainCentered",oe="isFountainTransition",se="isBlank",ce="isComment",le="isFountainCharacter",de="character",ue="isFountainDialogue",pe="isFountainParenthetical",he="isFountainAction",fe={border:"1px solid",padding:"6em",margin:"auto",width:"49em",overflowY:"scroll",fontSize:"16px",fontFamily:"CourierPrime, Courier, monospace",flex:"1"};function je(t,e){return Object(s.a)(Object(s.a)({},t),e)}function be(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&!(t.includes("|")||t.includes("@")||t.includes("#"))}var ye=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"render",value:function(){var t=this,e=this.props.scrapMap[this.props.scrapId];return e?this.props.scrapId===this.props.parentScrapId?Object(v.jsx)("div",{style:{color:"red"},children:"Scraps shouldn't include themselves"}):Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsx)(F.a,{icon:!0,color:"blue",onClick:function(){t.props.onGotoScrap()},children:Object(v.jsx)(u.a,{name:"angle right"})}),Object(v.jsxs)("div",{style:{marginLeft:"24px",flex:"1"},children:[Object(v.jsx)("div",{children:e.synopsis}),Object(v.jsx)("div",{children:St(e.intendedDurationSec)})]})]}):Object(v.jsxs)("div",{children:['Scrap "',this.props.scrapId,'" does not exist.']})}}]),r}(n.Component),ge=r(10),Oe=r.n(ge),ve=function(t){return t.contentState.getBlockMap().get(t.blockKey).getData().get(Yt)},Se=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(t){var n;return Object(m.a)(this,r),(n=e.call(this,t)).state={isHover:!1,scrapId:ve(t)},n}return Object(k.a)(r,[{key:"buildScrapLinkButton",value:function(){if(!this.state.isHover)return null;var t="/scrap/".concat(this.state.scrapId);return Object(v.jsx)(c.b,{to:t,children:Object(v.jsx)(F.a,{style:{cursor:"pointer",position:"absolute",top:"-12px",right:"-20px"},circular:!0,color:"blue",icon:"edit outline"})})}},{key:"onMouseEnter",value:function(){this.setState({isHover:!0})}},{key:"onMouseLeave",value:function(){this.setState({isHover:!1})}},{key:"getParentStyle",value:function(){var t={position:"relative",paddingRight:"20px",width:Gt,margin:0};return this.props.isFilterSelected&&(t.backgroundColor="#f6f6c6"),this.state.isHover&&(t.backgroundColor="#c6e1f6"),t}},{key:"renderSpecific",value:function(){return Object(v.jsx)("span",{children:this.props.children})}},{key:"render",value:function(){var t=this;return Object(v.jsxs)("div",{style:this.getParentStyle(),onMouseEnter:function(){t.onMouseEnter()},onMouseLeave:function(){t.onMouseLeave()},children:[this.renderSpecific(),this.buildScrapLinkButton()]})}}]),r}(n.Component);function xe(t,e,r){t.getData().get(ie)&&e(0,t.getText().length)}function me(t){return Vt}var ke=function(t){return Object(v.jsx)("div",{style:{fontWeight:"bold",width:Gt},children:t.children})},Ce=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return ke(this.props)}}]),r}(Se);function we(t,e,r){t.getData().get(oe)&&e(0,t.getText().length)}function De(t){return Vt}var Ie=function(t){return Object(v.jsx)("div",{style:{fontWeight:"bold",textAlign:"right",width:Gt},children:t.children})},Me=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return Ie(this.props)}}]),r}(Se);function Ee(t,e,r){t.getData().get(ae)&&e(0,t.getText().length)}function Fe(t){return Vt}var Te=function(t){return Object(v.jsx)("div",{style:{fontWeight:"bold",textAlign:"center",width:Gt},children:t.children})},Pe=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return Te(this.props)}}]),r}(Se);function We(t,e,r){t.getData().get(le)&&e(0,t.getText().length)}function Ae(t){return Vt*Math.ceil(t.length/28)}var Le=function(t){return Object(v.jsx)("div",{style:{fontWeight:"bold",marginLeft:"12em",width:"17em"},children:t.children})},Ne=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return Le(this.props)}}]),r}(Se);function Be(t,e,r){t.getData().get(ue)&&e(0,t.getText().length)}function ze(t){return Vt*Math.ceil(t.length/36)}var Je=function(t){return Object(v.jsx)("div",{style:{marginLeft:"6em",width:"23.5em"},children:t.children})},Ue=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return Je(this.props)}}]),r}(Se);function He(t,e,r){t.getData().get(pe)&&e(0,t.getText().length)}function Re(t){return Vt*Math.ceil(t.length/30)}var Ke=function(t){return Object(v.jsx)("div",{style:{marginLeft:"8.5em",width:"19.5em"},children:t.children})},Ve=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return Ke(this.props)}}]),r}(Se);function Ge(t,e,r){t.getData().get(he)&&e(0,t.getText().length)}function Ye(t){return Vt*Math.ceil(t.length/56)}var $e=function(t){return Object(v.jsx)("div",{style:{width:Gt},children:t.children})},_e=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){return $e(this.props)}}]),r}(Se);function qe(t,e,r){t.getData().get(Zt)&&e(0,t.getText().length)}function Xe(t){var e=t.replace("{{","").replace("}}","").trim();try{return xt(e.split("|")[1].trim())}catch(r){}return 0}var Qe=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){return Object(m.a)(this,r),e.apply(this,arguments)}return Object(k.a)(r,[{key:"renderSpecific",value:function(){var t=this.props.contentState.getBlockMap().get(this.props.blockKey).getData(),e=t.get(te),r=t.get(ee),n="".concat(e,": ").concat(St(r)),i=Math.ceil(n.length/60)+4,a=Math.ceil(r/Vt),o="".concat(20*a,"px"),s=Math.ceil(.01+a/i);return Object(v.jsxs)("div",{style:{height:o,background:"#afa",overflow:"hidden",position:"relative"},children:[Array(s).fill(0).map((function(){return Object(v.jsx)("div",{style:{display:"block",padding:"40px 0"},children:n})})),Object(v.jsx)("div",{style:{position:"absolute",bottom:0,width:"100%",height:"40px",background:"linear-gradient(180deg, transparent 0%, #afa 100%)",zIndex:1},children:"\xa0"})]})}}]),r}(Se);function Ze(t,e,r){t.getData().get(Xt)&&e(0,t.getText().length)}function tr(t){if(!t)return t;var e={},r=t.getText().trim();return r.length?(function(t){return t.startsWith("/*")}(r)&&(e.isCommentStart=!0),function(t){return t.endsWith("*/")}(r)&&(e.isCommentEnd=!0)):e.isBlank=!0,t.set("data",Oe.a.fromJS(e))}function er(t,e,r,n,i){if(!t)return{processProgress:n,contentBlock:t};var a=t.getData().toJS(),o=t.getText().trim(),s=!e||e.getData().get(se),c=!r||r.getData().get(se),l=e&&e.getData().get(de)||"";if(a.isBlank)s||a.isComment||(n.currentDurationSec+=Vt,a=je(a,Object(Kt.a)({},qt,Vt)));else if(a.isComment||(!function(t,e,r){return t&&e&&(/^(int|ext|est|i\/e)[\s.]/i.test(r)||r.startsWith(".")&&!r.startsWith(".."))}(s,c,o)?!function(t,e,r){return t&&e&&(r.startsWith(">")&&!r.endsWith("<")||r.toUpperCase()===r&&r.endsWith("TO:"))}(s,c,o)?!function(t){return t.startsWith(">")&&t.endsWith("<")}(o)?!function(t,e,r){return t&&!e&&(r.toUpperCase()===r||r.startsWith("@"))}(s,c,o)?!function(t,e){return!!t&&(!e.startsWith("(")||!e.endsWith(")"))}(l,o)?!function(t,e){return!!t&&e.startsWith("(")&&e.endsWith(")")}(l,o)?!function(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&2===t.split("|").length}(o)?!function(t){return!(!t.startsWith("{{")||!t.endsWith("}}"))&&t.includes("#")}(o)?be(o)||(a=je(a,function(t){var e;return e={},Object(Kt.a)(e,he,!0),Object(Kt.a)(e,qt,Ye(t)),e}(o)),n.currentDurationSec+=Ye(o)):a=je(a,function(t){var e,r=t.replace("{{","").replace("}}","").trim();return e={},Object(Kt.a)(e,Qt,r),Object(Kt.a)(e,Xt,!0),e}(o)):(a=je(a,function(t){var e,r=t.replace("{{","").replace("}}","").trim().split("|"),n=r[0].trim(),i=0;try{i=xt(r[1].trim())}catch(a){}return e={},Object(Kt.a)(e,te,n),Object(Kt.a)(e,ee,i),Object(Kt.a)(e,Zt,!0),Object(Kt.a)(e,qt,Xe(t)),Object(Kt.a)(e,_t,Xe(t)),e}(o)),n.currentDurationSec+=Xe(o)):(a=je(a,function(t,e){var r;return r={},Object(Kt.a)(r,pe,!0),Object(Kt.a)(r,de,t),Object(Kt.a)(r,qt,Re(e)),r}(l,o)),n.currentDurationSec+=Re(o)):(a=je(a,function(t,e){var r;return r={},Object(Kt.a)(r,ue,!0),Object(Kt.a)(r,de,t),Object(Kt.a)(r,qt,ze(e)),r}(l,o)),n.currentDurationSec+=ze(o)):(a=je(a,function(t){var e,r=t.replace(/\(V\.O\.\)/i,"").replace(/\(O\.S\.\)/i,"").replace(/\(CONT'D\)/i,"").replace(/\(CONT\u2019D\)/i,"").replace(/\(PRE-LAP\)/i,"").trim();return e={},Object(Kt.a)(e,le,!0),Object(Kt.a)(e,de,r),Object(Kt.a)(e,qt,Ae(t)),e}(o)),n.currentDurationSec+=Ae(o)):(a=je(a,function(t){var e;return e={},Object(Kt.a)(e,ae,!0),Object(Kt.a)(e,qt,Fe()),e}()),n.currentDurationSec+=Fe()):(a=je(a,function(t){var e;return e={},Object(Kt.a)(e,oe,!0),Object(Kt.a)(e,qt,De()),e}()),n.currentDurationSec+=De()):(a=je(a,function(t){var e;return e={},Object(Kt.a)(e,ie,!0),Object(Kt.a)(e,qt,me()),e}()),n.currentDurationSec+=me())),be(o)){a=je(a,function(t){var e,r=t.replace("{{","").replace("}}","").trim();return e={},Object(Kt.a)(e,ne,r),Object(Kt.a)(e,re,!0),e}(o));var d=a.scrapLink;if(i[d]){n.childScraps=n.childScraps.add(d);var u=i[d];a.isComment||(n.currentDurationSec+=u.intendedDurationSec)}}var p=t.set("data",Oe.a.fromJS(a));var h=p.getCharacterList().map((function(t,e){return t}));return{contentBlock:p.set("characterList",h),processProgress:n}}function rr(t,e,r,n){for(var i=!1,a={processStartEpoch:Date.now(),currentDurationSec:0,childScraps:Oe.a.OrderedSet()},o=t.getBlockMap(),s=Object(Wt.a)(o.keys()),c=0;c<s.length;c++){var l=s[c];o=o.set(l,tr(o.get(l)));var d=Date.now()-a.processStartEpoch;if(d>r&&(i=!0),d>n)break}for(var u=!1,p=0;p<s.length;p++){var h=s[p],f=o.get(h).getData().toJS();if(f.isCommentStart&&(u=!0),u){var j=o.get(h);f.isComment=!0;var b=Oe.a.fromJS(f),y=j.set("data",b);o=o.set(h,y)}f.isCommentEnd&&(u=!1);var g=Date.now()-a.processStartEpoch;if(g>r&&(i=!0),g>n)break}for(var O=0;O<s.length;O++){var v=O>0?o.get(s[O-1]):null,S=s[O],x=O+1<s.length?o.get(s[O+1]):null,m=er(o.get(S),v,x,a,e);a=m.processProgress,o=o.set(S,m.contentBlock);var k=Date.now()-a.processStartEpoch;if(k>r&&(i=!0),k>n)break}var C=t.set("blockMap",o),w=Date.now()-a.processStartEpoch;return console.log("Update took: "+w),{contentState:C,totalDurationSec:a.currentDurationSec,childScraps:a.childScraps,showTimeoutWarning:i}}var nr=new Lt.CompositeDecorator([{strategy:qe,component:function(t){return Object(v.jsx)("div",{style:{background:"#050",color:"white",display:"flex",padding:"8px"},children:Object(v.jsx)("div",{style:{flex:1},children:t.children})})}},{strategy:Ze,component:function(t){return Object(v.jsx)("div",{style:{background:"#c00",color:"white",display:"flex",padding:"8px"},children:Object(v.jsx)("div",{style:{flex:1},children:t.children})})}},{strategy:function(t,e,r){t.getData().get(re)&&e(0,t.getText().length)},component:function(t){var e=t.contentState.getBlockMap().get(t.blockKey).getData(),r=e.get(ne),n=e.get(ce),i=f(ut),a=Object(x.f)(),o=Object(x.g)(),s=o.pathname.replace("/scrap/",""),c=n?"#cfead9":"#555";return Object(v.jsxs)("div",{style:{background:c,fontWeight:"bold",display:"flex",padding:"8px"},children:[Object(v.jsx)("div",{style:{margin:"0",fontSize:"1px",height:"2px",width:"2px",overflow:"hidden",color:c},children:t.children}),Object(v.jsx)("div",{style:{flex:"1",cursor:"pointer",padding:"8px",border:"1px solid",background:"white",fontWeight:"normal"},children:Object(v.jsx)(ye,{parentScrapId:s,scrapId:r,scrapMap:i,onGotoScrap:function(){a.push("/scrap/".concat(r))}})})]})}},{strategy:xe,component:ke},{strategy:we,component:Ie},{strategy:Ee,component:Te},{strategy:We,component:Le},{strategy:Be,component:Je},{strategy:He,component:Ke},{strategy:function(t,e,r){t.getData().get(ce)&&!t.getData().get(re)&&e(0,t.getText().length)},component:function(t){return Object(v.jsx)("div",{style:{fontStyle:"italic",background:"#cfead9",width:Gt},children:t.children})}},{strategy:Ge,component:$e}]),ir=new Lt.CompositeDecorator([{strategy:qe,component:Qe},{strategy:Ze,component:function(t){return null}},{strategy:xe,component:Ce},{strategy:we,component:Me},{strategy:Ee,component:Pe},{strategy:We,component:function(t){var e=!1;return f(y).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(de)&&(e=!0),Object(v.jsx)(Ne,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:Be,component:function(t){var e=!1;return f(y).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(de)&&(e=!0),Object(v.jsx)(Ue,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:He,component:function(t){var e=!1;return f(y).currentCharacterFilter===t.contentState.getBlockMap().get(t.blockKey).getData().get(de)&&(e=!0),Object(v.jsx)(Ve,{blockKey:t.blockKey,contentState:t.contentState,isFilterSelected:e,children:t.children},t.key)}},{strategy:Ge,component:_e}]),ar={GREEN:{color:"green"}},or=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(t){var n;return Object(m.a)(this,r),(n=e.call(this,t)).domEditor=void 0,n.remapEditorContent=Rt()((function(){var t=n.state.editorState.getCurrentContent().getPlainText();if(t!==n.state.lastEmittedStr){n.persistProse(t);var e=rr(n.state.editorState.getCurrentContent(),n.props.scrapMap,50,500),r=n.props.scrapMap[n.props.scrapId];if(!function(t,e){if(t.size!==e.length)return!1;for(var r=0;r<e.length;r++)if(!t.includes(e[r]))return!1;return!0}(e.childScraps,r.childScraps)){var i=P.Scrap.create(Object(s.a)(Object(s.a)({},r),{},{childScraps:Object(Wt.a)(e.childScraps.toArray())}));n.props.onScrapUpdate(i)}n.setState({editorState:Lt.EditorState.set(n.state.editorState,{currentContent:e.contentState}),lastEmittedStr:t,actualDurationSec:Math.round(e.totalDurationSec),parseErrorState:e.showTimeoutWarning})}}),200),n.state=n.initializeState(t),n.remapEditorContent(),n}return Object(k.a)(r,[{key:"initializeState",value:function(t){return{editorState:this.buildInitialEditorState(t),lastEmittedStr:"",scrapId:t.scrapId,durationErrorString:null,actualDurationSec:0,parentScrapIds:this.buildParentScrapIds(t),parseErrorState:!1,durationInputKey:"duration-key-"+Date.now()}}},{key:"setHeaderOptions",value:function(){this.props.onUpdateHeaderOptions({currentScrapId:this.props.scrapId,showReadLink:!0,showEditLink:!1,characterFilters:[],currentCharacterFilter:"",currentCompletionFilter:"",traitFilters:[],currentTraitFilter:""})}},{key:"buildInitialEditorState",value:function(t){var e=t.scrapMap[t.scrapId];return e?Lt.EditorState.createWithContent(Lt.ContentState.createFromText(e.prose),nr):Lt.EditorState.createEmpty()}},{key:"componentDidMount",value:function(){this.setHeaderOptions()}},{key:"componentDidUpdate",value:function(t,e,r){this.state.scrapId!==this.props.scrapId&&(this.setHeaderOptions(),this.setState(this.initializeState(this.props)),this.remapEditorContent())}},{key:"buildParentScrapIds",value:function(t){var e=t.scrapMap[this.props.scrapId],r=[];for(var n in t.scrapMap){var i=t.scrapMap[n];i.childScraps.includes(e.id)&&r.push(i.id)}return r}},{key:"getBreadcrumbs",value:function(t){var e,r=this,n=t.stories.map((function(t){return r.props.storyMap[t]})).filter(Boolean),i=n.map((function(t){return Object(v.jsx)(zt.a,{link:!0,children:Object(v.jsx)(c.b,{to:"/story/"+t.id,children:t.name})})}));e=n.length?Object(v.jsxs)("div",{children:["Stories:",Object(v.jsx)(Jt.a,{children:i.reduce((function(t,e){return[t,Object(v.jsx)(Ut.a,{icon:"right chevron"}),e]}))})]}):Object(v.jsx)("div",{children:"No parent stories"});var a,o=this.state.parentScrapIds.map((function(t){return r.props.scrapMap[t]})).filter(Boolean),s=o.map((function(t){return Object(v.jsx)(zt.a,{link:!0,children:Object(v.jsx)(c.b,{to:"/scrap/"+t.id,children:t.synopsis})})}));return a=o.length?Object(v.jsxs)("div",{children:["Scraps:",Object(v.jsx)(Jt.a,{children:s.reduce((function(t,e){return[t,Object(v.jsx)(Ut.a,{icon:"right chevron"}),e]}))})]}):Object(v.jsx)("div",{children:"No parent scraps"}),Object(v.jsxs)("div",{children:[e,a]})}},{key:"onSynopsisChange",value:function(t){var e=this.props.scrapMap[this.props.scrapId];e.synopsis=t,this.props.onScrapUpdate(e)}},{key:"getPrimaryForm",value:function(t){var e=this;return Object(v.jsx)(M.a,{children:Object(v.jsx)(Ot.a,{children:Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsx)("div",{style:{flex:1,margin:"16px 0"},children:Object(v.jsx)(Ot.a.Input,{label:"Synopsis",defaultValue:t.synopsis,onChange:function(t){return e.onSynopsisChange(t.target.value)}})}),Object(v.jsx)("div",{style:{flex:1,margin:"16px"},children:Object(v.jsx)(Ot.a.Input,{style:{flex:1},label:"Intended Duration (HH:MM:SS)",defaultValue:St(t.intendedDurationSec),error:this.state.durationErrorString,onChange:function(t){return e.onDurationChange(t.target.value)}},this.state.durationInputKey)}),Object(v.jsx)("div",{style:{flex:1,margin:"auto"},children:Object(v.jsxs)(Ot.a.Field,{children:[Object(v.jsxs)("label",{children:["Current Actual Duration: ",St(this.state.actualDurationSec)]}),Object(v.jsx)(F.a,{onClick:function(){return e.updateExpectedDurationSec()},disabled:this.state.actualDurationSec===t.intendedDurationSec,children:"Update expected duration"})]})})]})})})}},{key:"onDurationChange",value:function(t){var e;try{e=xt(t)}catch(n){return this.setDurationErrorString(!0)}var r=this.props.scrapMap[this.props.scrapId];r.intendedDurationSec=e,this.props.onScrapUpdate(r),this.setDurationErrorString(!1)}},{key:"setDurationErrorString",value:function(t){this.setState({durationErrorString:t?"Please enter a duration of format HH:MM:SS":null})}},{key:"updateExpectedDurationSec",value:function(){var t=this.props.scrapMap[this.props.scrapId];t.intendedDurationSec=this.state.actualDurationSec,this.props.onScrapUpdate(t),this.setState({durationInputKey:"duration-key-"+Date.now()}),this.setDurationErrorString(!1)}},{key:"getProseEditorToolbar",value:function(){var t=this,e=this.state.parseErrorState?Object(v.jsx)("div",{style:{color:"red"},children:"Parsing took too long, please break into smaller chunks"}):null;return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("button",{onClick:function(){return t.addChildScrap()},children:"Add child scrap"}),Object(v.jsx)("button",{onClick:function(){return t.replacePlaceholderScraps()},children:"Replace placeholder scraps"})]}),e]})}},{key:"setDomEditorRef",value:function(t){this.domEditor=t}},{key:"focus",value:function(){this.domEditor.focus()}},{key:"onProseChange",value:function(t){this.setState({editorState:t}),this.remapEditorContent()}},{key:"getSelectedText",value:function(){var t=this.state.editorState,e=Bt()(t);return e?e.map((function(t){return t.getText()})).join("\n"):""}},{key:"onCut",value:function(t,e,r){var n=this;e.preventDefault();var i=this.state.editorState,a=this.getSelectedText();At.a(a).then((function(){if(r){var t=Lt.Modifier.replaceText(i.getCurrentContent(),i.getSelection(),"");n.setState({editorState:Lt.EditorState.set(i,{currentContent:t})})}}))}},{key:"persistProse",value:function(t){var e=this.props.scrapMap[this.props.scrapId];e.prose=t,this.props.onScrapUpdate(e)}},{key:"addChildScrap",value:function(){var t=this,e=this.state.editorState,r=e.getSelection(),n=this.getSelectedText(),i=Object(Q.a)(),a=function(t,e,r){var n=[];return e[t]&&(n=e[t].stories),P.Scrap.create({id:r,synopsis:"New Scrap created in editor",prose:"this has placeholder content for now",stories:n})}(this.props.scrapId,this.props.scrapMap,i);n.trim().length&&(a.prose=n),this.props.onScrapCreate(a);var o="\n{{"+i+"}}\n",s=r.isCollapsed()?Lt.Modifier.insertText(e.getCurrentContent(),r,o):Lt.Modifier.replaceText(e.getCurrentContent(),r,o);this.setState({editorState:Lt.EditorState.createWithContent(Lt.ContentState.createFromText(s.getPlainText()),nr)},(function(){t.remapEditorContent()}))}},{key:"replacePlaceholderScraps",value:function(){for(var t,e=this,r=this.state.editorState,n=r.getSelection(),i=this.getSelectedText(),a=i,o=new RegExp("{{([^}]+)}}","g");t=o.exec(i);){var s=t[0],c=t[1].split("|");if(2==c.length){var l=0;try{l=xt(c[1].trim())}catch(h){}var d=Object(Q.a)(),u=P.Scrap.create({id:d,synopsis:c[0].trim(),prose:s,intendedDurationSec:l});this.props.onScrapCreate(u),a=a.replace(s,"\n{{"+d+"}}\n")}}var p=Lt.Modifier.replaceText(r.getCurrentContent(),n,a);this.setState({editorState:Lt.EditorState.createWithContent(Lt.ContentState.createFromText(p.getPlainText()),nr)},(function(){e.remapEditorContent()}))}},{key:"render",value:function(){var t=this,e=this.props.scrapMap[this.props.scrapId];return e?Object(v.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[this.getBreadcrumbs(e),this.getPrimaryForm(e),this.getProseEditorToolbar(),Object(v.jsx)("div",{onClick:function(){t.focus()},style:fe,children:Object(v.jsx)(Lt.Editor,{customStyleMap:ar,stripPastedStyles:!0,onCut:function(e,r){t.onCut(e,r,!0)},onCopy:function(e,r){t.onCut(e,r,!1)},editorState:this.state.editorState,ref:function(e){t.setDomEditorRef(e)},onChange:function(e){t.onProseChange(e)}})})]},"scrap-details-"+this.props.scrapId):Object(v.jsx)("div",{children:"Whoops, could not find scrap"})}}]),r}(n.Component);function sr(t){var e=f(G),r=f(ut),n=h();return Object(v.jsx)(or,{scrapId:t.match.params.id,scrapMap:r,storyMap:e,onScrapCreate:function(t){return n(ht(t.toJSON()))},onScrapUpdate:function(t){return n(ft(t.toJSON()))},onUpdateHeaderOptions:function(t){return n(g(t))}})}var cr=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(){var t;Object(m.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))).state={showListInput:!0,showCurrentScores:!1,nextCandidateLabel:"",nextCandidateDesc:"",candidates:[],winMatrix:[],candidateIndexA:-1,candidateIndexB:-1},t}return Object(k.a)(r,[{key:"addCandidate",value:function(){for(var t=[].concat(Object(Wt.a)(this.state.candidates),[{label:this.state.nextCandidateLabel,description:this.state.nextCandidateDesc,currentScore:1,wins:0,losses:0}]),e=1/(10*t.length),r=Object(Wt.a)(Array(t.length)).map((function(r){return Array(t.length).fill(e)})),n=0;n<r.length;n++)r[n][n]=0;this.setState(Object(s.a)(Object(s.a)({},this.state),{},{candidates:t,winMatrix:r,nextCandidateLabel:"",nextCandidateDesc:""}))}},{key:"setupNewComparison",value:function(){var t=this,e=this.state.candidates.map((function(e,r){return 1/t.getTotalComparisons(r)})),r=this.randomSelectWeighted(e),n=e.map((function(e,n){return n===r?0:1/(t.state.winMatrix[n][r]+t.state.winMatrix[r][n])})),i=this.randomSelectWeighted(n);this.setState(Object(s.a)(Object(s.a)({},this.state),{},{showListInput:!1,candidateIndexA:r,candidateIndexB:i}))}},{key:"randomSelectWeighted",value:function(t){for(var e=t.reduce((function(t,e){return t+e})),r=Math.random()*e,n=0,i=0;i<t.length;i++)if((n+=t[i])>=r)return i;throw Error("should not get here")}},{key:"getTotalComparisons",value:function(t){for(var e=0,r=0;r<this.state.winMatrix.length;r++)e+=this.state.winMatrix[t][r]+this.state.winMatrix[r][t];return e}},{key:"renderComparison",value:function(){var t=this;if(this.state.candidateIndexA<0||this.state.candidateIndexB<0)return Object(v.jsx)("div",{children:"no comparison yet"});var e=this.state.candidates[this.state.candidateIndexA],r=this.state.candidates[this.state.candidateIndexB];return Object(v.jsxs)("div",{style:{marginTop:"100px",marginBottom:"100px"},children:[Object(v.jsx)("h2",{children:"Comparison"}),Object(v.jsxs)("div",{style:{display:"flex"},children:[Object(v.jsxs)("div",{style:{flex:1},children:[Object(v.jsxs)("h3",{children:[e.label,Object(v.jsx)("button",{onClick:function(){return t.updateWin(t.state.candidateIndexA,t.state.candidateIndexB)},children:"Select"})]}),e.description.split("\n").map((function(t){return Object(v.jsx)("p",{children:t})}))]}),Object(v.jsxs)("div",{style:{flex:1},children:[Object(v.jsxs)("h3",{children:[r.label,Object(v.jsx)("button",{onClick:function(){return t.updateWin(t.state.candidateIndexB,t.state.candidateIndexA)},children:"Select"})]}),r.description.split("\n").map((function(t){return Object(v.jsx)("p",{children:t})}))]})]})]})}},{key:"updateWin",value:function(t,e){var r=this,n=this.state.winMatrix;n[t][e]+=1;var i=this.state.candidates;i[t].wins+=1,i[e].losses+=1;for(var a=0;a<1e3;a++){for(var o=0;o<i.length;o++){for(var c=0,l=0;l<i.length;l++)c+=n[o][l];for(var d=0,u=0;u<i.length;u++){if(o!==u)d+=(n[o][u]+n[u][o])/(i[o].currentScore+i[u].currentScore)}i[o].currentScore=c/d}for(var p=0,h=0;h<i.length;h++)p+=i[h].currentScore;p/=i.length;for(var f=0;f<i.length;f++)i[f].currentScore/=p}this.setState(Object(s.a)(Object(s.a)({},this.state),{},{candidates:i,winMatrix:n}),(function(){r.setupNewComparison()}))}},{key:"renderWinMatrix",value:function(){return this.state.showCurrentScores?Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Current Win Matrix"}),Object(v.jsx)("pre",{children:this.state.winMatrix.map((function(t){return t.join(",\t")+"\n"}))})]}):Object(v.jsx)("div",{})}},{key:"renderCandidates",value:function(){if(!this.state.showCurrentScores&&!this.state.showListInput)return Object(v.jsx)("div",{});var t=this.state.candidates.map((function(t){return t})).sort((function(t,e){return e.currentScore-t.currentScore}));return Object(v.jsxs)("div",{children:[Object(v.jsxs)("h2",{children:[t.length," Candidates"]}),t.map((function(t,e){return Object(v.jsx)("div",{children:Object(v.jsxs)("h3",{children:[t.label," (",t.currentScore,", ",t.wins," wins, ",t.losses," losses)"]})})}))]})}},{key:"toggleShowCurrentScores",value:function(){this.setState(Object(s.a)(Object(s.a)({},this.state),{},{showCurrentScores:!this.state.showCurrentScores}))}},{key:"updateNextCandidateLabel",value:function(t){this.setState(Object(s.a)(Object(s.a)({},this.state),{},{nextCandidateLabel:t}))}},{key:"updateNextCandidateDesc",value:function(t){this.setState(Object(s.a)(Object(s.a)({},this.state),{},{nextCandidateDesc:t}))}},{key:"render",value:function(){var t,e=this;return t=this.state.showListInput?Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Declare Candidates"}),Object(v.jsx)("p",{children:"Let's create some candidates"}),Object(v.jsxs)("div",{children:[Object(v.jsx)("input",{type:"text",value:this.state.nextCandidateLabel,onChange:function(t){return e.updateNextCandidateLabel(t.target.value)}}),Object(v.jsx)("textarea",{value:this.state.nextCandidateDesc,onChange:function(t){return e.updateNextCandidateDesc(t.target.value)}})]}),Object(v.jsx)("button",{style:{display:"block"},onClick:function(){return e.addCandidate()},children:"Add Candidate"}),Object(v.jsx)("button",{style:{display:"block"},onClick:function(){return e.setupNewComparison()},children:"Parse and begin"}),this.renderCandidates()]}):Object(v.jsxs)("div",{children:[this.renderComparison(),Object(v.jsx)("button",{style:{display:"block"},onClick:function(){return e.toggleShowCurrentScores()},children:"Toggle results"}),this.renderWinMatrix(),this.renderCandidates()]}),Object(v.jsxs)("div",{style:{margin:"24px"},children:[Object(v.jsx)("h1",{children:"Decisions"}),Object(v.jsx)("p",{children:"Let's make some decisions based on pairwise comparisons. You know that FaceMash scene in Social Network? It's just like that, except hopefully you're using it for better decisions."}),t]})}}]),r}(n.Component);function lr(t,e,r){var n,i=(null===(n=r[t])||void 0===n?void 0:n.prose)||"",a=[].concat(Object(Wt.a)(e),[t]),o=rr(Lt.ContentState.createFromText(i),r,500,5e3),s=[];return o.contentState.getBlocksAsArray().forEach((function(n){var i=n.getData();if(!i.get(ce))if(i.get(re)){var o=i.get(ne);if(r[o]){if(a.includes(o))throw Error("Replacing scrap ".concat(o," would cause infinite recursion"));var c=lr(o,a,r);s.push.apply(s,Object(Wt.a)(c))}}else{var l=n.set("data",i.set(Yt,t).set($t,e));s.push(l)}})),s}var dr=r(402);function ur(t,e){var r;return(null===(r=e[t])||void 0===r?void 0:r.synopsis)||""}function pr(t){return"".concat(t,"%")}var hr=function(){function t(e,r,n,i){Object(m.a)(this,t),this.headerText=void 0,this.id=void 0,this.startSec=void 0,this.durationSec=void 0,this.characters=void 0,this.pendingCompletion=void 0,this.traits=void 0,this.headerText=e,this.id=r,this.startSec=n,this.durationSec=i,this.characters=new Set,this.pendingCompletion=!1,this.traits=new Set}return Object(k.a)(t,[{key:"render",value:function(t,e,r,n){var i="grey";return(this.characters.has(e)||this.pendingCompletion&&r||this.traits.has(n))&&(i="red"),Object(v.jsx)(dr.a,{content:St(this.durationSec),header:this.headerText,mouseEnterDelay:50,mouseLeaveDelay:50,trigger:Object(v.jsx)(c.b,{to:"/scrap/"+this.id,style:{cursor:"pointer",display:"inline-block",height:"100%",boxShadow:"inset 0px 0px 0px 1px #555",position:"absolute",width:pr(100*this.durationSec/t),left:pr(100*this.startSec/t),background:i,zIndex:2},children:Object(v.jsx)("div",{children:"\xa0"})})},"key-"+this.id)}}]),t}(),fr=function(){function t(){Object(m.a)(this,t),this.blocks=[]}return Object(k.a)(t,[{key:"lastBlockId",value:function(){return this.blocks.length?this.blocks[this.blocks.length-1].id:""}},{key:"render",value:function(t,e,r,n,i){return Object(v.jsx)("div",{style:{position:"relative",width:pr(e),height:"40px",borderBottom:"1px solid"},children:this.blocks.map((function(e){return e.render(t,r,n,i)}))})}}]),t}(),jr=function(){function t(e,r,n){if(Object(m.a)(this,t),this.isValid=!1,this.durationSec=0,this.percentComplete=0,this.rows=[],r[e]){var i=function(t,e){for(var r=[],n=0,i=0,a=0;a<t.length;a++){for(var o=t[a].getData().get(qt)||0,s=t[a].getData().get(_t)||0,c=t[a].getData().get(de)||null,l=!!t[a].getData().get(Zt),d=(t[a].getData().get(Qt)||"").split("#").filter(Boolean).map((function(t){return t.trim()})),u=[].concat(Object(Wt.a)(t[a].getData().get($t)||[]),[t[a].getData().get(Yt)||""]),p=function(t){r.length<=t&&r.push(new fr);var i=r[t].lastBlockId();u[t]===i?r[t].blocks[r[t].blocks.length-1].durationSec+=o:r[t].blocks.push(new hr(ur(u[t],e),u[t],n,o)),l&&(r[t].blocks[r[t].blocks.length-1].pendingCompletion=!0),c&&r[t].blocks[r[t].blocks.length-1].characters.add(c),d.forEach((function(e){r[t].blocks[r[t].blocks.length-1].traits.add(e)}))},h=0;h<u.length;h++)p(h);n+=o,i+=s}return{totalDurationSec:n,percentComplete:Math.ceil(1e3*(1-i/n))/10,rows:r}}(n,r);this.durationSec=i.totalDurationSec,this.percentComplete=i.percentComplete,this.durationSec&&(this.isValid=!0,this.rows=i.rows)}}return Object(k.a)(t,[{key:"getSecondMarkers",value:function(t){for(var e=Math.round(t/100*4)+1,r=this.durationSec/(e-1),n=0,i=[],a=0;a<e;a++){var o=Math.round(n);i.push(o),n+=r}return i}},{key:"render",value:function(t,e,r,n){var i=this,a=this.getSecondMarkers(t),o=41*this.rows.length;return Object(v.jsxs)("div",{style:{width:"100%",overflowX:"scroll",background:"lightgrey"},children:[this.rows.map((function(a){return a.render(i.durationSec,t,e,r,n)})),Object(v.jsx)("div",{style:{height:"24px",position:"relative",width:pr(t),background:"white"},children:a.map((function(t,e){var r={display:"inline-block",position:"absolute",fontSize:"16px",fontFamily:"CourierPrime, Courier, monospace",paddingTop:"".concat(o,"px"),top:"-".concat(o,"px")};return e+1===a.length?(r.paddingRight="8px",r.textAlign="right",r.borderRight="2px solid",r.right=pr(100-100*t/i.durationSec)):(r.paddingLeft="8px",r.textAlign="left",r.borderLeft="2px solid",r.left=pr(100*t/i.durationSec)),Object(v.jsx)("div",{style:r,children:St(t)})}))})]})}}]),t}(),br=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(t){var n;return Object(m.a)(this,r),(n=e.call(this,t)).state=n.initializeState(t),n}return Object(k.a)(r,[{key:"initializeState",value:function(t){return{scrapId:t.scrapId,timeline:new jr(t.scrapId,t.scrapMap,t.parsedContentBlocks),zoomLevel:100,minimized:!1}}},{key:"zoomIn",value:function(){this.setState({zoomLevel:2*this.state.zoomLevel})}},{key:"zoomOut",value:function(){this.setState({zoomLevel:Math.max(100,this.state.zoomLevel/2)})}},{key:"flipMinimization",value:function(){this.setState({minimized:!this.state.minimized})}},{key:"render",value:function(){var t=this;if(!this.state.timeline.isValid)return Object(v.jsx)("div",{children:"... loading timeline... "});var e=this.state.minimized?null:Object(v.jsxs)("div",{style:{display:"inline-block"},children:[Object(v.jsx)(F.a,{onClick:function(){return t.zoomOut()},disabled:100===this.state.zoomLevel,icon:!0,children:Object(v.jsx)(u.a,{name:"zoom-out"})}),Object(v.jsx)(F.a,{onClick:function(){return t.zoomIn()},icon:!0,children:Object(v.jsx)(u.a,{name:"zoom-in"})})]});return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{style:{marginBottom:"12px",display:"flex"},children:[e,Object(v.jsx)("span",{style:{flex:"1"},children:"\xa0"}),Object(v.jsxs)("span",{style:{margin:"auto 24px"},children:["Percent complete: ",this.state.timeline.percentComplete]}),Object(v.jsx)(F.a,{onClick:function(){return t.flipMinimization()},icon:!0,children:Object(v.jsx)(u.a,{name:this.state.minimized?"window maximize outline":"window minimize outline"})})]}),this.state.minimized?null:this.state.timeline.render(this.state.zoomLevel,this.props.currentCharacterFilter,!!this.props.currentCompletionFilter,this.props.currentTraitFilter)]})}}]),r}(n.Component),yr=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(t){var n;return Object(m.a)(this,r),(n=e.call(this,t)).state=n.initializeState(t),n}return Object(k.a)(r,[{key:"initializeState",value:function(t){return{scrapId:t.scrapId,editorState:this.buildInitialEditorState(t)}}},{key:"componentDidUpdate",value:function(t,e,r){this.state.scrapId!==this.props.scrapId&&this.setState(this.initializeState(this.props))}},{key:"buildInitialEditorState",value:function(t){return t.scrapMap[t.scrapId]?Lt.EditorState.createWithContent(Lt.ContentState.createFromBlockArray(this.props.parsedContentBlocks),ir):Lt.EditorState.createEmpty()}},{key:"normalizeProse",value:function(t){return t}},{key:"render",value:function(){return Object(v.jsx)("div",{style:fe,children:Object(v.jsx)(Lt.Editor,{readOnly:!0,onChange:function(){},editorState:this.state.editorState})})}}]),r}(n.Component);function gr(t){var e=f(ut),r=h(),n=f(y);return Object(v.jsx)(Or,{scrapId:t.match.params.id,scrapMap:e,onUpdateHeaderOptions:function(t){return r(g(Object(s.a)(Object(s.a)({},n),t)))},headerOptions:n})}var Or=function(t){Object(C.a)(r,t);var e=Object(w.a)(r);function r(t){var n;return Object(m.a)(this,r),(n=e.call(this,t)).state={scrapId:t.scrapId,hasLoaded:!1,parsedContentBlocks:[]},n}return Object(k.a)(r,[{key:"componentDidMount",value:function(){var t=lr(this.props.scrapId,[],this.props.scrapMap),e=function(t){var e={},r=0;return t.forEach((function(t){var n=t.getData(),i=n.get(de),a=n.get(qt)||0;r+=a,i&&(e[i]||(e[i]={character:i,totalDurationSec:0,percentDurationSec:0}),e[i].totalDurationSec+=a)})),Object.values(e).sort((function(t,e){return e.totalDurationSec-t.totalDurationSec})).map((function(t){return t.percentDurationSec=t.totalDurationSec/r,t}))}(t),r=function(t){var e={};return t.forEach((function(t){(t.getData().get(Qt)||"").split("#").filter(Boolean).forEach((function(t){var r=t.trim();e[r]||(e[r]={trait:r,numberOfAppearances:0}),e[r].numberOfAppearances+=1}))})),Object.values(e).sort((function(t,e){return e.numberOfAppearances-t.numberOfAppearances}))}(t);this.setState({hasLoaded:!0,parsedContentBlocks:t}),this.props.onUpdateHeaderOptions({currentScrapId:this.state.scrapId,showReadLink:!1,showEditLink:!0,characterFilters:e,traitFilters:r})}},{key:"render",value:function(){return this.state.hasLoaded?Object(v.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[Object(v.jsx)(br,{scrapId:this.state.scrapId,scrapMap:this.props.scrapMap,parsedContentBlocks:this.state.parsedContentBlocks,currentCharacterFilter:this.props.headerOptions.currentCharacterFilter||"",currentCompletionFilter:this.props.headerOptions.currentCompletionFilter||"",currentTraitFilter:this.props.headerOptions.currentTraitFilter||""}),Object(v.jsx)(yr,{scrapId:this.state.scrapId,scrapMap:this.props.scrapMap,parsedContentBlocks:this.state.parsedContentBlocks})]}):Object(v.jsx)("div",{children:" ... loading ..."})}}]),r}(n.Component);var vr=function(){return Object(v.jsx)("div",{style:{padding:0,margin:0,height:"100vh"},children:Object(v.jsxs)(c.a,{children:[Object(v.jsx)(S,{}),Object(v.jsx)("div",{style:{height:"calc(100% - 68px)"},children:Object(v.jsxs)(x.c,{children:[Object(v.jsx)(x.a,{path:"/decisions",component:cr}),Object(v.jsx)(x.a,{path:"/data",component:Pt}),Object(v.jsx)(x.a,{path:"/story/:id",component:kt}),Object(v.jsx)(x.a,{path:"/scrap/:id",component:sr}),Object(v.jsx)(x.a,{path:"/read/:id",component:gr}),Object(v.jsx)(x.a,{path:"/",component:yt})]})})]})})},Sr=Object(j.a)({reducer:{storyList:X,scrapList:jt,headerOptions:O},middleware:function(t){return t().concat([K,lt])}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(383);o.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(p.a,{store:Sr,children:Object(v.jsx)(vr,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[384,1,2]]]);
//# sourceMappingURL=main.403d970e.chunk.js.map